/*!CK:3224104436!*//*1437395864,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["CmJTe"]); }

__d("PhotoAlbumAudienceInput",["Arbiter","CSS","DOM","Event"],function(a,b,c,d,e,f,g,h,i,j){b.__markCompiled&&b.__markCompiled();function k(l,m,n,o,p){"use strict";this.$PhotoAlbumAudienceInput0=l;if(m){this.$PhotoAlbumAudienceInput1=m;this.$PhotoAlbumAudienceInput2=n;this.$PhotoAlbumAudienceInput3=o;this.$PhotoAlbumAudienceInput4=p;g.subscribe('Tokenizer/init',this.$PhotoAlbumAudienceInput5.bind(this));j.listen(this.$PhotoAlbumAudienceInput3,'click',this.$PhotoAlbumAudienceInput6.bind(this));}}k.prototype.removeHiddenPrivacyWidget=function(){"use strict";[this.$PhotoAlbumAudienceInput0,this.$PhotoAlbumAudienceInput1,this.$PhotoAlbumAudienceInput4].forEach(function(l){if(l&&h.hasClass(l,'hidden_elem'))i.remove(l);});};k.prototype.$PhotoAlbumAudienceInput6=function(){"use strict";this.$PhotoAlbumAudienceInput7.removeAllTokens();this.$PhotoAlbumAudienceInput8(null,null);};k.prototype.$PhotoAlbumAudienceInput5=function(l,m){"use strict";if(this.$PhotoAlbumAudienceInput7||this.$PhotoAlbumAudienceInput2!=m.element)return;this.$PhotoAlbumAudienceInput7=m;this.$PhotoAlbumAudienceInput8(null,null);g.subscribe('Form/change',this.$PhotoAlbumAudienceInput8.bind(this));};k.prototype.$PhotoAlbumAudienceInput8=function(l,m){"use strict";var n=this.$PhotoAlbumAudienceInput7.getTokens().length>0;this.$PhotoAlbumAudienceInputa(n);};k.prototype.$PhotoAlbumAudienceInputa=function(l){"use strict";h.conditionShow(this.$PhotoAlbumAudienceInput1,l);h.conditionShow(this.$PhotoAlbumAudienceInput0,!l);this.$PhotoAlbumAudienceInput4&&h.conditionShow(this.$PhotoAlbumAudienceInput4,l);};e.exports=k;},null);
__d("PhotoAlbumPlacesTypeahead",["Arbiter"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();function h(i){"use strict";if(!i)return;if(i.getCore().getHiddenValue()){var j={uid:i.getCore().getHiddenValue(),text:i.getCore().getValue()};g.inform('PhotoAlbumPlacesTypeahead.EXIST_PLACE',j);}i.subscribe('select',function(k,l){g.inform('PhotoAlbumPlacesTypeahead.SELECTED_PLACE',l.selected);}.bind(this));i.subscribe('reset',function(){if(!i.getCore().getHiddenValue())g.inform('PhotoAlbumPlacesTypeahead.RESET_PLACE');}.bind(this));i.subscribe('focus',function(){g.inform('PhotoAlbumPlacesTypeahead.FOCUSED');}.bind(this));this._initialized=true;}h.prototype.init=function(i){"use strict";if(this._initialized)return;h.call(this,i);};e.exports=h;},null);
__d("PersistentAlbumDataStore",["WebStorage"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h='fb_album_recovery',i=7*60*60*24,j={_storageExists:true,_initializeWebStorage:function(){var k=g.getLocalStorage();if(!k){j._storageExists=false;return;}if(!k.getItem(h))k.setItem(h,JSON.stringify({}));},_getAlbumsObject:function(){if(!j._storageExists)return {};j._initializeWebStorage();return JSON.parse(g.getLocalStorage().getItem(h));},_setAlbumsObject:function(k){if(!j._storageExists)return;j._initializeWebStorage();g.getLocalStorage().setItem(h,JSON.stringify(k));},_getLocalStorageByAlbum:function(k){return (j._getAlbumsObject()[k]||j.createAlbum(k));},_setLocalStorageByAlbum:function(k,l){var m=j._getAlbumsObject();m[k]=l;j._setAlbumsObject(m);},createAlbum:function(k){var l={privacy:null,tags:{},created_at:Date.now()};j._setLocalStorageByAlbum(k,l);return l;},deleteAlbum:function(k){var l=j._getAlbumsObject();delete l[k];j._setAlbumsObject(l);},getAlbumPrivacy:function(k){return j._getLocalStorageByAlbum(k).privacy;},setAlbumPrivacy:function(k,l){var m=j._getLocalStorageByAlbum(k);m.privacy=l;j._setLocalStorageByAlbum(k,m);},saveTag:function(k,l,m){var n=j._getLocalStorageByAlbum(k);if(!n.tags[l])n.tags[l]=[];m.recovered=true;n.tags[l].push(m);j._setLocalStorageByAlbum(k,n);},removeTag:function(k,l,m){var n=j._getLocalStorageByAlbum(k),o=n.tags[l]||[];for(var p=0;p<o.length;p++)if(o[p].subject===m||o[p].name===m){o.splice(p,1);break;}n.tags[l]=o;j._setLocalStorageByAlbum(k,n);},getTags:function(k,l){return (j._getLocalStorageByAlbum(k).tags[l]||[]);},deleteExpiredAlbums:function(){var k=j._getAlbumsObject();for(var l in k){var m=k[l];if(Date.now()-m.created_at>i*1000)j.deleteAlbum(l);}}};e.exports=j;},null);
__d("PhotoBulkEditTagger",["Arbiter","AsyncRequest","CSS","DOM","DOMQuery","Event","FaceboxSourceConstants","Parent","PersistentAlbumDataStore","PhotosConst","PhotosTaggingWaterfall","PhotoTagger","PhotoTagStore","SubscriptionsHandler","Vector","$","csx","ge"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){b.__markCompiled&&b.__markCompiled();var y=60;for(var z in r)if(r.hasOwnProperty(z))ba[z]=r[z];var aa=r===null?null:r.prototype;ba.prototype=Object.create(aa);ba.prototype.constructor=ba;ba.__superConstructor__=r;function ba(ca,da,ea,fa){"use strict";r.call(this,ca);this.editor=ca;this.faceboxes=[];this.gkEnableTagNext=fa.gkEnableTagNext;this._qn=fa.qn;this.tokenizer=ea;this.editor.registerTagger(this);this.typeahead=ea.getTypeahead();this.handlers=new t();this.root=this.editor.getRoot();this.tagger=da;this.hideNewTagTimer=null;this.photoKey=null;this._needTaggingData=true;this._currentRecognition={box:null,isTagged:false,suggestion:null};this._hoverState=false;this._tagging=false;this.setupHandlers();this._sendWaterfallLogSignal(q.BEGIN);this.fetchTaggingSuggestions();this.setTagAccumulator(fa.bulkSaveTags);this.setNeedTaggingData(fa.needTaggingData);this.version=p.BULK_EDITOR;l.listen(this.root,'mousemove',function(event){var ga=event.getTarget();if(this._hoverState&&!(n.byClass(ga,'faceBox')||n.byClass(ga,'tagPointer')||n.byClass(ga,'arrow')||n.byClass(ga,'faceboxSuggestion'))){this.removeSuggestionFromTagger();this.hideTagger();}}.bind(this));}ba.prototype.setupUserActionLogging=function(){"use strict";return null;};ba.prototype.logUserActionEvent=function(ca){"use strict";return null;};ba.prototype.addFaceboxes=function(ca){"use strict";this.faceboxes=k.scry(ca.parentNode,'.faceBox');this.faceboxes.sort(function(ga,ha){return ga.offsetLeft===ha.offsetLeft?ga.offsetTop-ha.offsetTop:ga.offsetLeft-ha.offsetLeft;});var da=n.byClass(ca,'editablePhoto'),ea=s.getInstance().getPhotoTags(da.getAttribute('data-photoid')),fa=[];Object.keys(ea).forEach(function(ga){if(ea[ga].fbid)fa[ea[ga].fbid]=true;});this.faceboxes.forEach(function(ga){var ha=this.getFaceboxSuggestionFromFaceboxElem(ga),ia=ga.getAttribute('data-faceboxid');if((ha&&ea[ha.getAttribute('data-id')])||fa[ia]){j.remove(ga);return;}var ja={image:ca,facebox:ga};l.listen(ga,'mouseenter',this._mouseOverFacebox.bind(this,ja));}.bind(this));};ba.prototype.saveTag=function(ca,da,ea){"use strict";if(!da.info.recovered){aa.saveTag.call(this,ca,da,ea);var fa=this.getTaggingDataForSave(da,ea);o.saveTag(this.photoData.albumFBID,this.photoData.fbid,fa);}g.inform('PhotoBulkEditTagger.TAG_SAVED',{editor:this.root,fbid:this.photoData.fbid});};ba.prototype.recoverPhoto=function(ca){"use strict";this.setupPhotoDataForTarget(ca.getRoot());var da=o.getTags(this.photoData.albumFBID,this.photoData.fbid);da.forEach(function(ea){var fa=this.tokenizer.createToken({uid:ea.subject?ea.subject:ea.name,text:ea.name,suggestion:ea.from_facebox,freeform:(ea.subject===''),recovered:true});this.tokenizer.addToken(fa);s.getInstance().storeTagWithOptions(this.photoData.fbid,ea.subject,ea.x,ea.y,ea);}.bind(this));};ba.prototype.setNeedTaggingData=function(ca){"use strict";this._needTaggingData=ca;return this;};ba.prototype.setTagAccumulator=function(ca){"use strict";aa.setTagAccumulator.call(this,ca);return this;};ba.prototype.needTaggingData=function(){"use strict";return this._needTaggingData;};ba.prototype.setupHandlers=function(){"use strict";l.listen(this.root,'click',this.clickHandler.bind(this));this.tokenizer.subscribe(['addToken','removeToken'],this.handleTokenAction.bind(this));this.tokenizer.subscribe('switchTarget',this.switchPhoto.bind(this));this.tokenizer.subscribe('initialized',this.editor._recoverPhotos.bind(this.editor));g.subscribe('PhotoBulkEditTagger.DATA_SOURCE_READY',this.useTaggingDataSource.bind(this));g.subscribe(this.editor.mapEventNameToNamespace('PhotosBulkEditor.PHOTO_REORDER_START'),this.hideTagger.bind(this));};ba.prototype.hideTagger=function(){"use strict";aa.hideTagger.apply(this,arguments);if(this._currentRecognition.box&&!this._currentRecognition.isTagged)i.show(this._currentRecognition.box);this._tagging=false;this._hoverState=false;this._currentRecognition.box=null;this._currentRecognition.isTagged=false;this._currentRecognition.suggestion=null;this.recognizedUsers=[];};ba.prototype.done=function(){"use strict";this._sendWaterfallLogSignal(q.FINISH);};ba.prototype.handleTokenAction=function(ca,da){"use strict";var ea=v(this.photoKey),fa=j.find(ea,'.peopleIcon'),ga=j.find(ea,'.editablePhotoTagList'),ha=j.find(fa,'.count'),ia=this.tokenizer.getTokens().length,ja=da.info.suggestion?m.UPLOADER_SUGGEST:null;if(this._currentRecognition.box)this._currentRecognition.isTagged=!!ia;i.conditionClass(fa,'hasPeople',!!ia);i.conditionClass(ga,'hasPeople',!!ia);j.setContent(ha,ia);if(ca=='addToken'){this.saveTag(ca,da,ja);if(!this.gkEnableTagNext)return;for(var ka=0;ka<this.faceboxes.length;ka++)if(i.shown(this.faceboxes[ka])){setTimeout(function(){this.showTaggerByFacebox(this.faceboxes[ka]);}.bind(this),100);break;}}else{this.removeTag(ca,da);o.removeTag(this.photoData.albumFBID,this.photoData.fbid,da.info.uid);g.inform('PhotoBulkEditTagger.TAG_REMOVED',{editor:this.root,fbid:this.photoData.fbid});}};ba.prototype.useTaggingDataSource=function(ca,da){"use strict";if(!this._needTaggingData)return;var ea=this.tokenizer.getTypeahead();ea.swapData(da);this.setNeedTaggingData(false);};ba.prototype.getTaggerPositioningOrigin=function(){"use strict";return u.getElementPosition(this.root);};ba.prototype.showTaggerByFacebox=function(ca){"use strict";var da=n.byClass(ca,'faceBox');if(!da)da=n.byClass(ca,'recognitionBox');this._currentRecognition.box=da;var ea=n.byClass(ca,'editablePhotoImage');this.setupPhotoDataForTarget(ea);var fa=j.find(ea,'.scaledImage img'),ga=null,ha=null,ia=null,ja=this.getRecognitionBoxCenter(da,fa);ga=ja.boxPos;ha=ja.boxDim;ia=ja.taggerPos;i.hide(this._currentRecognition.box);this.recognizedUsers=JSON.parse(da.getAttribute('data-recognizeduids'));this.setUpTagger(fa,ea,ga,ha,ia);};ba.prototype.getRecognitionBoxCenter=function(ca,da){"use strict";var ea=u.getElementPosition(ca).add(u.getElementDimensions(ca).mul(.5)),fa=u.getElementDimensions(this._currentRecognition.box),ga=this.calcTaggerPosition(da,ea,fa.x,fa.y);return {boxPos:ea,boxDim:fa,taggerPos:ga};};ba.prototype.setUpTagger=function(ca,da,ea,fa,ga){"use strict";this.calcClickPoint(ca,ea);ga.setElementPosition(this.tagger);if(fa)fa.setElementDimensions(this.tagger);i.hide(j.find(da,'.clickToTagMessage'));this._sendWaterfallLogSignal(q.TAG_FACE);this.updateTypeaheadSuggestions();this.updateWithSuggestions();this.showTagger();this._tagging=true;};ba.prototype.clickHandler=function(event){"use strict";var ca=event.getTarget();if(n.byClass(ca,'photoTagTypeahead'))return;if(this._hoverState){this._hoverState=false;this._tagging=true;return;}if(this.tagger){this.hideTagger();this.removeSuggestionFromTagger();this.handlers.release();}if(n.byClass(ca,'photoContextualSelector')||n.byClass(ca,'removePhotoButton'))return;var da=n.byClass(ca,'editablePhotoImage');if(!da){var ea=n.byClass(ca,'peopleIcon');if(ea)this.setupPhotoDataForTarget(ea);return;}this.setupPhotoDataForTarget(da);var fa=j.find(da,'.scaledImage img'),ga=null,ha=null,ia=null,ja=n.byClass(ca,'faceBox');if(!ja)ja=n.byClass(ca,'recognitionBox');this._currentRecognition.box=ja;if(this._currentRecognition.box&&i.shown(this._currentRecognition.box)){var ka=this.getRecognitionBoxCenter(ja,fa);ga=ka.boxPos;ha=ka.boxDim;ia=ka.taggerPos;i.hide(this._currentRecognition.box);this._currentRecognition.isTagged=false;var la=this.getFaceboxSuggestionFromFaceboxElem(ja);if(la){this._currentRecognition.suggestion=la;this.addSuggestionToTagger(ja,la);this._sendFaceboxSuggestionLogSignal(la.getAttribute('data-id'),m.UPLOADER_SUGGEST);}else this.recognizedUsers=JSON.parse(ja.getAttribute('data-recognizeduids'));}if(ia===null){ga=u.getEventPosition(event);ia=this.calcTaggerPosition(fa,ga,y);}if(!ia)return;this.setUpTagger(fa,da,ga,ha,ia);};ba.prototype._mouseOverFacebox=function(ca){"use strict";if(this._tagging)return;var da=ca.image,ea=ca.facebox,fa=this.getFaceboxSuggestionFromFaceboxElem(ea);if(fa){this._hoverState=true;this._currentRecognition.box=ea;this._currentRecognition.suggestion=fa;this.setupPhotoDataForTarget(da);this.addSuggestionToTagger(ea,fa);this._sendFaceboxSuggestionLogSignal(fa.getAttribute('data-id'),m.UPLOADER_SUGGEST);this._sendWaterfallLogSignal(q.HOVER_TAG_FACE);var ga=u.getElementPosition(ea).add(u.getElementDimensions(ea).mul(.5)),ha=u.getElementDimensions(this._currentRecognition.box),ia=this.calcTaggerPosition(da,ga,ha.x,ha.y);this.calcClickPoint(da,ga);ia.setElementPosition(this.tagger);ha.setElementDimensions(this.tagger);this.showTagger();}};ba.prototype.fetchTaggingSuggestions=function(){"use strict";this.logUserActionEvent('sugg_fetch');new h().setURI(this.ajaxURIs.tagsInit).setData({owner:this.photoData.owner}).setOption('retries',1).setHandler(function(ca){var da=ca.getPayload();this.featuredSuggestions=da.featuredTaggees;this.friendSuggestions=da.friendTaggees;this.logUserActionEvent('sugg_fetch_done');}.bind(this)).send();};ba.prototype.switchPhoto=function(ca,da){"use strict";var ea=x(da);ea&&this.setupPhotoDataForTarget(ea);this.hideTagger();};ba.prototype.getImageByID=function(ca){"use strict";return x('editablePhoto_'+ca);};ba.prototype.setupPhotoDataForTarget=function(ca){"use strict";var da;if(ca&&!i.hasClass(ca,'editablePhoto')){da=n.byClass(ca,'editablePhoto');}else da=ca;if(!da){this.photoKey=null;this.photoData=null;return false;}var ea=da.id;if(ea===this.photoKey)return;this.photoKey=ea;this.photoData=this.editor.getPhotoData(ea);this.tokenizer.setTokenarea(j.find(da,'div.editablePhotoTagList'));};ba.prototype.getPosition=function(){"use strict";return this.photoData.fbid;};ba.prototype.tagsChangeHandler=function(ca){"use strict";};ba.prototype.removeTagByID=function(ca,da,ea){"use strict";this.hideTagger();this.setupPhotoDataForTarget(this.getImageByID(ca));aa.removeTagByID.call(this,ca,da,ea);};ba.prototype.setupFaceboxSuggestionHandlers=function(ca,da){"use strict";var ea=j.find(da,"._570w"),fa=j.find(da,"._570x");this.handlers.engage();this.handlers.addSubscriptions(l.listen(ea,'click',function(ga){this.dismissFaceboxSuggestion(ca.id.replace('face:',''),da.getAttribute('data-id'),this.photoData.owner,m.UPLOADER_DISMISS);this.removeSuggestionFromTagger();this.hideTagger();j.remove(this.getFaceboxSuggestionFromFaceboxElem(ca));}.bind(this)),l.listen(fa,'click',function(ga){var ha=this.tokenizer.createToken({uid:da.getAttribute('data-id'),text:da.getAttribute('data-text'),suggestion:true});this.removeSuggestionFromTagger();i.hide(ca);this.tokenizer.addToken(ha);}.bind(this)));};Object.assign(ba.prototype,{elemNames:{}});e.exports=ba;},null);
__d("PhotosBulkBackdateEditor",["Event","Arbiter","DOMQuery","Focus","Form"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l={setup:function(m,n){g.listen(m,'click',function(){n.setContext(m);n.show();});var o=i.find(n.getContent(),"^.photosBulkDatePicker .saveBackdatedTime");g.listen(o,'click',function(){var p=k.serialize(n.getContent()),q=p.backdated_date,r=parseInt(p.use_date_from_file,10)>0,s=i.scry(n.getContent(),'#hide_from_newsfeed')[0],t=s&&s.checked;h.inform('PhotosBulkBackdateEditor.SAVED',{context:m,backdatedDate:q,hideFromNewsfeed:t,useDateFromFile:r});n.hide();j.set(m);});}};e.exports=l;},null);
__d("PhotoBulkEditTokenizer",["DOM","Event","Input","Parent","Tokenizer","UserAgent_DEPRECATED","getObjectValues"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();for(var n in k)if(k.hasOwnProperty(n))p[n]=k[n];var o=k===null?null:k.prototype;p.prototype=Object.create(o);p.prototype.constructor=p;p.__superConstructor__=k;function p(){"use strict";if(k!==null)k.apply(this,arguments);}p.prototype.init=function(q,r,s,t){"use strict";this._tokenareaListeners={};o.init.call(this,q,r,s,t);this.inform('initialized');};p.prototype.initEvents=function(){"use strict";var q=l.firefox()<4?'keypress':'keydown';h.listen(this.input,'paste',this.paste.bind(this));h.listen(this.input,q,this.keydown.bind(this));};p.prototype.setTokenarea=function(q){"use strict";this.tokenarea=q;this.addTokenareaListener(q);this.reset();};p.prototype.addTokenareaListener=function(q){"use strict";if(this._tokenareaListeners[q.id])return;var r=this.handleEvents.bind(this);this._tokenareaListeners[q.id]=m(h.listen(q,{click:r,keydown:r}));};p.prototype.handleEvents=function(event){"use strict";var q=j.byClass(event.getTarget(),'editablePhotoTagList');if(!q){return;}else if(this.tokenarea!==q){this.setTokenarea(q);this.inform('switchTarget',this.tokenarea.id);}return o.handleEvents.call(this,event);};p.prototype.reset=function(){"use strict";var q=this.getTokenElements().map(function(r){return {uid:g.scry(r,'input')[0].value,text:g.scry(r,'input')[1].value};});i.reset(this.input);return o.reset.call(this,q);};p.prototype.updateTokenareaVisibility=function(){"use strict";return null;};p.prototype.insertToken=function(q){"use strict";g.prependContent(this.tokenarea,q.getElement());};e.exports=p;},null);
__d("ProgressiveDatepicker",["Arbiter","ArbiterMixin","CSS","DataStore","DOM","Event","Parent","getElementText","mixin","shield"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){b.__markCompiled&&b.__markCompiled();function q(w){return new Date(w[0],w[1],w[2],w[3],w[4]);}function r(w,x){while(w.length)k.insertAfter(x,w.pop());}var s=o(h);for(var t in s)if(s.hasOwnProperty(t))v[t]=s[t];var u=s===null?null:s.prototype;v.prototype=Object.create(u);v.prototype.constructor=v;v.__superConstructor__=s;function v(w,x){"use strict";s.call(this);this._root=w;this._savedLabels={};this._savedPeriodsBack=[];this._savedPeriodsFront=[];this._menus={};this._dayOrderAscending=x.dayorderascending;var y=0;if(x.gmtoffset!==(void 0))y=-(new Date()).getTimezoneOffset()-x.gmtoffset;this._mintime=x.mintime&&new Date(1000*x.mintime-y*60000);this._maxtime=x.maxtime&&new Date(1000*x.maxtime-y*60000);j.set(w,'datepicker',this);k.scry(w,'select').forEach(function(z){l.listen(z,'change',p(this._handleChange,this,z));var aa=m.byClass(z,'period');l.listen(z,'focus',i.addClass.bind(null,aa,'periodFocus'));l.listen(z,'blur',i.removeClass.bind(null,aa,'periodFocus'));this._setMenuSelectionState(z);if(z.getAttribute('data-name')==='month')this._filterInvalidDates();}.bind(this));k.scry(w,'a.periodLabel').forEach(function(z){var aa=m.byClass(z,'period');l.listen(z,'click',function(){i.addClass(aa,'periodSelected');i.addClass(aa,'periodFocus');});});this._filterInvalidDates();this.inform('initialized',this,g.BEHAVIOR_STATE);}v.prototype.setDate=function(w,x,y,z,aa){"use strict";this._addSavedPeriods();var ba=v.PERIODS;for(var ca=0;ca<ba.length;ca++)this._setValueForPeriod(ba[ca],arguments[ca]);this._filterInvalidDates();this.inform('changed');};v.prototype.setDateWithTimestamp=function(w){"use strict";var x=new Date(w);this.setDate(x.getFullYear(),x.getMonth()+1,x.getDate(),x.getHours(),x.getMinutes());};v.prototype.isSet=function(){"use strict";var w=v.PERIODS;for(var x=0;x<w.length;x++)if(this._getValueForPeriod(w[x]))return true;return false;};v.prototype.getRoot=function(){"use strict";return this._root;};v.prototype.getValues=function(){"use strict";var w=v.PERIODS,x={};for(var y=0;y<w.length;y++){var z=this._getValueForPeriod(w[y]);if(z)x[w[y]]=z;}return x;};v.prototype.getDate=function(){"use strict";var w=this.getValues();return new Date(w.year||0,(w.month||1)-1,w.day||1,w.hour||0,w.minute||0);};v.prototype.getTimestamp=function(){"use strict";return Math.round(this.getDate().getTime()/1000);};v.prototype._setValueForPeriod=function(w,x){"use strict";var y=this._menuForPeriodName(w);if(!y)return;if(x===(void 0))x='';var z=y.options;for(var aa=0,ba=z.length;aa<ba;aa++)if(z[aa].value==x){y.selectedIndex=aa;break;}this._setMenuSelectionState(y);};v.prototype._getValueForPeriod=function(w){"use strict";var x=this._menuForPeriodName(w);return (x&&x.options[x.selectedIndex].value);};v.prototype._handleChange=function(w){"use strict";this._setMenuSelectionState(w);this._filterInvalidDates();this.inform('changed');};v.prototype._setMenuSelectionState=function(w){"use strict";var x=m.byClass(w,'period');if(!x)return;if(i.hasClass(x,'periodRequired')){if(w.selectedIndex===0)w.selectedIndex=1;}else this._updateLabel(w);var y=w.getAttribute('data-name'),z=w.options[w.selectedIndex].value;i.conditionClass(x,'periodSelected',z);i.conditionClass(this._root,this._selectedClass(y),z);if(!z)this._resetMenu(v.PERIODS.indexOf(y)+1);};v.prototype._updateLabel=function(w){"use strict";var x=w.getAttribute('data-name'),y=w.options[0];if(!this._savedLabels[x])this._savedLabels[x]=n(y);if(w.selectedIndex===0){k.setContent(y,this._savedLabels[x]);}else k.setContent(y,'--');};v.prototype._daysInMonth=function(w,x){"use strict";return new Date(w||1999,x+1||1,0).getDate();};v.prototype._daysInCurrentMonth=function(){"use strict";return this._daysInMonth(this._getValueForPeriod('year'),this._getValueForPeriod('month')-1);};v.prototype._menuForPeriodName=function(w){"use strict";if(!this._menus[w])this._menus[w]=k.scry(this._root,'.'+w+'Menu')[0];return this._menus[w];};v.prototype._selectedClass=function(w){"use strict";return 'uiProgressiveDatepickerSelected-'+w;};v.prototype._resetMenu=function(w){"use strict";var x=v.PERIODS;for(;w<x.length;w++){var y=x[w],z=this._menuForPeriodName(y);if(!z)return;if(m.byClass(z,'periodRequired')){z.selectedIndex=1;}else{i.removeClass(m.byClass(z,'period'),'periodSelected');i.removeClass(this._root,this._selectedClass(y));z.selectedIndex=0;this._updateLabel(z);}}};v.prototype._addSavedPeriods=function(){"use strict";var w=v.PERIODS;for(var x=0;x<w.length;x++){var y=this._menuForPeriodName(w[x]);if(!y)return;this._savedPeriodsFront[x]||(this._savedPeriodsFront[x]=[]);this._savedPeriodsBack[x]||(this._savedPeriodsBack[x]=[]);var z=y.options[0],aa=y.options[y.options.length-1];if(x===v.PERIODS.indexOf('hour')||x===v.PERIODS.indexOf('minute')||(x===v.PERIODS.indexOf('day')&&this._dayOrderAscending)){r(this._savedPeriodsFront[x],z);r(this._savedPeriodsBack[x],aa);}else{r(this._savedPeriodsBack[x],z);r(this._savedPeriodsFront[x],aa);}}};v.prototype._filterInvalidDates=function(){"use strict";this._addSavedPeriods();var w=v.PERIODS,x=this.getValues();for(var y=0;y<w.length;y++){var z=this._menuForPeriodName(w[y]);if(!z)return;this._savedPeriodsFront[y]||(this._savedPeriodsFront[y]=[]);this._savedPeriodsBack[y]||(this._savedPeriodsBack[y]=[]);for(var aa=1;aa<z.options.length;){var ba=z.options[aa],ca=[((y-1>=0)?x[w[0]]:0),((y-1>=1)?x[w[1]]-1:0),((y-1>=2)?x[w[2]]:1),((y-1>=3)?x[w[3]]:0),((y-1>=4)?x[w[4]]:0)];ca[y]=ba.value;if(y===v.PERIODS.indexOf('month'))ca[y]=ca[y]-1;var da=q(ca),ea=[((y-1>=0)?x[w[0]]:9001),((y-1>=1)?x[w[1]]-1:11),((y-1>=2)?x[w[2]]:this._daysInCurrentMonth()),((y-1>=3)?x[w[3]]:23),((y-1>=4)?x[w[4]]:59)];ea[y]=ba.value;if(y===v.PERIODS.indexOf('month')){ea[y]--;ea[y+1]=this._daysInMonth(ea[0],ea[1]);}var fa=q(ea),ga=(da>this._maxtime),ha=(fa<this._mintime),ia=(y===v.PERIODS.indexOf('day')&&ba.value>this._daysInCurrentMonth());if(ha||ga||ia){if(ba.selected){ba.selected=false;this._resetMenu(y);}k.remove(ba);if(ga||ia){this._savedPeriodsBack[y].push(ba);}else this._savedPeriodsFront[y].push(ba);}else aa++;}}};v.getInstance=function(w){"use strict";return w?j.get(w,'datepicker'):null;};Object.assign(v,{PERIODS:['year','month','day','hour','minute']});e.exports=v;},null);
__d("PhotosBulkEditablePhoto",["Arbiter","AsyncDialog","AsyncRequest","AsyncResponse","CSS","Dialog","DOM","Event","Focus","Form","Input","Parent","PhotosConst","PlaceUtils","ProgressiveDatepicker","csx","cx","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){b.__markCompiled&&b.__markCompiled();var y=null,z=null,aa=false;function ba(ca,da,ea,fa,ga,ha,ia){"use strict";this._root=ca;this._mentionsTypeahead=da;this._placesTypeahead=ea;this._photoData=fa;this._hasOwnPlaceValue=!!ea.getCore().getHiddenValue();var ja=m.find(ca,'.placesInput'),ka=m.find(ca,'.captionTextarea'),la=m.find(ea.element,'.uiTypeaheadCloseButton');this._metadataInputs=m.find(ca,'.metadataInputs');this._editorId=ga;this._published=ha;this._showMove=ia;this._photoDataKey=this._root.id;this._hasTimeTaken=!!this._photoData.timeTaken;this._hasExistingDateValue=this._photoData.isBackdated;this._listeners=[n.listen(ca,'click',this._handleClick.bind(this)),n.listen(ja,'focus',this._placesFocus.bind(this)),n.listen(ka,'focus',this._captionFocus.bind(this)),n.listen(ka,'blur',this._save.bind(this)),n.listen(la,'click',function(){setTimeout(this._save.bind(this),0);}.bind(this)),n.listen(ca,'submit',function(){return false;})];this._previousSaveData=p.serialize(this._root);var ma=m.scry(this._root,'div.backdateInput .periodMenu');for(var na=0;na<ma.length;na++){var oa=ma[na];this._listeners.push(n.listen(oa,'change',function(){return this._saveDate();}.bind(this)));}var pa=m.scry(this._root,"._2sfm").pop();if(pa){var qa=pa.getAttribute('data-direction');this._listeners.push(n.listen(pa,'click',this._rotate.bind(this,qa)));}var ra=m.scry(ca,'.photoContextualSelector')[0];if(ra){var sa=m.scry(ra,'.moveAlbum')[0];sa&&this._listeners.push(n.listen(sa,'click',this._move.bind(this)));var ta=m.scry(ra,'.albumCover')[0];ta&&this._listeners.push(n.listen(ta,'click',this._setAlbumCover.bind(this)));var ua=m.scry(ra,'.removePhoto')[0];ua&&this._listeners.push(n.listen(ua,'click',this.remove.bind(this)));}else{var va=m.find(ca,'.removePhotoButton');this._listeners.push(n.listen(va,'click',this.remove.bind(this)));}this._placesDataListener=[ea.subscribe(['select','reset','render'],function(wa,xa){k.conditionClass(this._root,'focusedInput',(wa=='render'));if(wa=='render')return;if(wa=='reset'&&ea.getCore().getHiddenValue())return;if(xa&&xa.selected){y=xa.selected;if(z==y.text){aa=true;}else{z=y.text;aa=false;}}else{y=null;z=null;aa=false;}this._hasOwnPlaceValue=(wa=='select');k.conditionClass(m.find(ca,'.placeIcon'),'hasPlace',this._hasOwnPlaceValue);if(this._hasOwnPlaceValue)this._save();}.bind(this))];this._placesInputBlurListener=ea.getCore().subscribe('blur',function(wa,xa){k.removeClass(this._root,'focusedInput');}.bind(this));g.inform(this.mapEventNameToNamespace('PhotosBulkEditablePhoto.INITIALIZED'),this,g.BEHAVIOR_PERSISTENT);}ba.prototype.getPhotoDataKey=function(){"use strict";return this._photoDataKey;};ba.prototype.getPhotoData=function(){"use strict";return this._photoData;};ba.prototype.getRoot=function(){"use strict";return this._root;};ba.prototype.getDragHandle=function(){"use strict";return this.getRoot();};ba.prototype.getRotateButtonType=function(){"use strict";return this._rotateButtonType;};ba.prototype.swapData=function(ca,da){"use strict";var ea=this._mentionsTypeahead.getData(),fa=this._placesTypeahead.getData();if(ea!==ca)this._mentionsTypeahead.swapData(ca);if(fa!==da){var ga=this._placesTypeahead.getCore().getValue(),ha=this._placesTypeahead.getCore().getHiddenValue();this._placesTypeahead.swapData(da);if(this.hasOwnPlaceValue())this._placesTypeahead.getCore().select({text:ga,uid:ha});}};ba.prototype.hasOwnPlaceValue=function(){"use strict";return this._hasOwnPlaceValue;};ba.prototype.setAlbumPlace=function(ca,da){"use strict";this._hasOwnPlaceValue=false;var ea=this._placesTypeahead.getCore();k.conditionClass(m.find(this._root,'.placeIcon'),'hasPlace',!!ca);if(ca){ea.select(ca);}else ea.reset();if(!da)this._save();};ba.prototype.addPlaceSelectHandler=function(ca){"use strict";this._placesDataListener.push(this._placesTypeahead.subscribe('select',ca));};ba.prototype.mapEventNameToNamespace=function(ca){"use strict";return ca+(this._editorId?'/'+this._editorId:'');};ba.prototype.setDate=function(ca,da){"use strict";if(this._hasExistingDateValue)return;var ea=!ca,fa=ca;if(ea){if(!this._hasTimeTaken)return;fa=Math.round(this._photoData.timeTaken/600)*600*1000;}var ga=m.find(this.getRoot(),'.uiProgressiveDatepicker'),ha=u.getInstance(ga);ha.setDateWithTimestamp(fa);k.conditionClass(m.find(this._root,'.dateIcon'),'hasDate',!!fa);if(ea)this._saveDate(da);};ba.prototype._doRemove=function(){"use strict";m.remove(this._root);this._unsubscribeAll();g.inform(this.mapEventNameToNamespace('PhotosBulkEditablePhoto.REMOVED'),this);};ba.prototype._unsubscribeAll=function(){"use strict";this._listeners.forEach(function(ca){ca.remove();});this._listeners=[];this._placesDataListener.forEach(function(ca){this._placesTypeahead.unsubscribe(ca);}.bind(this));this._placesTypeahead.getCore().unsubscribe(this._placesInputBlurListener);};ba.prototype._handleClick=function(ca){"use strict";var da=ca.getTarget();if(r.byClass(da,'confirmPhotoBackdate')){this._saveDate();return;}if(!r.byClass(da,'metaIcon'))return;k.addClass(this._root,'showControls');if(r.byClass(da,'placeIcon')){this._showMetadataInput('place');o.set(this._placesTypeahead.getCore().getElement());}else if(r.byClass(da,'dateIcon')){this._showMetadataInput('date');}else if(r.byClass(da,'peopleIcon')){g.inform(this.mapEventNameToNamespace('PhotosBulkEditablePhoto.TAG_BUTTON_CLICKED'),this);this._showMetadataInput('people');}else k.removeClass(this._root,'showControls');};ba.prototype.hideMetadataInputs=function(){"use strict";this._showMetadataInput();};ba.prototype._showMetadataInput=function(ca){"use strict";['people','date','place'].forEach(function(da){k.conditionClass(this._metadataInputs,da,ca==da);}.bind(this));};ba.prototype._captionFocus=function(ca){"use strict";this.hideMetadataInputs();k.addClass(this._root,'focusedInput');};ba.prototype.remove=function(){"use strict";var ca={fbid:this._photoData.fbid,version:s.BULK_EDITOR,confirmed:true};new l().setTitle(x._("Delete Photo")).setBody(x._("Are you sure you want to delete this photo?")).setButtons(l.OK_AND_CANCEL).setModal(true).setHandler(function(){k.addClass(this._root,'editablePhotoWillBeRemoved');new i().setURI('/ajax/photos/photo/delete/dialog.php').setData(ca).setHandler(function(da){if(da.getPayload().success){this._doRemove();}else k.removeClass(this._root,'editablePhotoWillBeRemoved');}.bind(this)).setErrorHandler(function(da){k.removeClass(this._root,'editablePhotoWillBeRemoved');j.defaultErrorHandler(da);}.bind(this)).send();}.bind(this)).show();};ba.prototype._setAlbumCover=function(){"use strict";var ca={aid:this._photoData.aid,albumFBID:this._photoData.albumFBID,fbid:this._photoData.fbid,owner:this._photoData.owner,pid:this._photoData.pid},da=new i().setURI('/ajax/photos/album/setcover/').setData(ca).setAllowCrossPageTransition(false);h.send(da);};ba.prototype._move=function(){"use strict";var ca={aid:this._photoData.aid,albumFBID:this._photoData.albumFBID,datakey:this._photoDataKey,fbid:this._photoData.fbid,owner:this._photoData.owner,pid:this._photoData.pid},da=new i().setURI('/ajax/photos/photo/move/dialog.php').setData(ca).setAllowCrossPageTransition(false);h.send(da);};ba.prototype._timeclose=function(ca,da){"use strict";ca=ca||0;da=da||0;return Math.abs(ca-da)<43200;};ba.prototype._placesFocus=function(ca){"use strict";k.addClass(this._root,'focusedInput');var da=m.scry(this._root,'input.latitude')[0],ea=m.scry(this._root,'input.longitude')[0],fa=m.scry(this._root,'input.takentime')[0],ga=fa?q.getValue(fa):null,ha=this._placesTypeahead.getData(),ia=ha.getBootstrapData(),ja={};if(da&&ea){ja={latitude:q.getValue(da),longitude:q.getValue(ea),proximity_boost:'true',city_id:null,search_time:ga};ha.setQueryData(ja,false);if(!t.placesClose(ia.latitude,ia.longitude,ja.latitude,ja.longitude)||!this._timeclose(ia.search_time,ja.search_time))ha.setBootstrapData(ja,false).setBootstrapEndpoint(ha.getQueryEndpoint());}else{ja={latitude:null,longitude:null,proximity_boost:null,city_id:null,search_time:ga};if(y)if(y.city_id){ja.city_id=y.city_id;}else if(y.latitude&&y.longitude){ja.latitude=y.latitude;ja.longitude=y.longitude;}ha.setQueryData(ja,false);if(!aa){ha.setBootstrapData(ja).resetBootstrapEndpoint(true);}else if(!t.placesClose(ia.latitude,ia.longitude,ja.latitude,ja.longitude)||!this._timeclose(ia.search_time,ja.search_time))ha.setBootstrapData(ja,false).resetBootstrapEndpoint();}};ba.prototype._saveDate=function(ca){"use strict";var da=m.find(this._root,'div.backdateInput'),ea=p.serialize(da);ea.source=this.source;ea.fbid=this._photoData.fbid;ea.version=s.BULK_EDITOR;ea.bulk=!!ca;k.addClass(da,'backdating');new i().setURI('/ajax/photos/photo/backdate/').setData(ea).setRelativeTo(this._root).send();};ba.prototype._save=function(){"use strict";k.removeClass(this._root,'focusedInput');var ca=p.serialize(this._root);if(this._previousSaveData){var da=false;for(var ea in ca){if(ea!=='caption'&&ea!=='location'&&ea!=='location_data')continue;if(ca[ea]!==this._previousSaveData[ea]){da=true;this._previousSaveData[ea]=ca[ea];}}if(!da)return;}ca.source=this.source;ca.bulk=!this._hasOwnPlaceValue;new i().setURI('/ajax/photos/metadata/save/').setData(ca).setAllowCrossPageTransition(true).send();};ba.prototype._setLoadingIndicator=function(ca){"use strict";k.conditionClass(this._root,"_2sfl",ca);};ba.prototype._rotate=function(ca){"use strict";var da={fbid:this._photoData.fbid,cs_ver:s.BULK_EDITOR,editor_id:this._editorId,published:this._published,showMove:this._showMove};da[ca]=1;this._setLoadingIndicator(true);new i('/ajax/photos/photo/rotate/').setData(da).setHandler(function(ea){m.replace(this._root,ea.getPayload());this._unsubscribeAll();g.inform(this.mapEventNameToNamespace('PhotosBulkEditablePhoto.ROTATED'),this);}.bind(this)).setFinallyHandler(function(){this._setLoadingIndicator(false);}.bind(this)).setMethod('POST').send();return false;};e.exports=ba;},null);
__d("PhotosBulkEditablePhotoPlaceholder",["CSS","DOM","Event","csx","mixInEventEmitter"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();function l(m,n,o){"use strict";this._root=m;this._progressBar=n;this._uploadID=o;this._initAndGetGatedButton("._3273",'cancelButtonClicked');this._retryButton=this._initAndGetGatedButton("._3p03",'retryButtonClicked');this._errorOkayButton=this._initAndGetGatedButton("._8qx",'dismissPlaceholder');this._errorCloseButton=this._initAndGetGatedButton("._8qy",'dismissPlaceholder');}l.prototype._initAndGetGatedButton=function(m,n){"use strict";var o=h.scry(this._root,m);if(o.length){o=o[0];i.listen(o,'click',function(){return this.emit(n,this._uploadID);}.bind(this));return o;}};l.prototype.getProgressBar=function(){"use strict";return this._progressBar;};l.prototype.getRoot=function(){"use strict";return this._root;};l.prototype.hide=function(){"use strict";g.hide(this._root);};l.prototype.show=function(){"use strict";g.show(this._root);};l.prototype.showRetryButton=function(){"use strict";this._retryButton&&g.show(this._retryButton);};l.prototype.showErrorOkayButton=function(){"use strict";this._errorOkayButton&&g.show(this._errorOkayButton);};l.prototype.showErrorCloseButton=function(){"use strict";this._errorCloseButton&&g.show(this._errorCloseButton);};k(l,{cancelButtonClicked:true,retryButtonClicked:true,dismissPlaceholder:true});e.exports=l;},null);
__d("XPhotoBatchEditLocationController",["XController"],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports=b("XController").create("\/photos\/edit\/batch\/location\/",{});},null);
__d("PhotosBulkEditor",["ActorURI","Arbiter","AsyncRequest","Button","CSS","DOM","Event","PageTransitions","Parent","PhotosConst","SortableGroup","xuiglyph","XPhotoBatchEditLocationController","mapObject","createIxElement","cx","emptyFunction"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){b.__markCompiled&&b.__markCompiled();var x={ASCENDING:'ascending',DESCENDING:'descending',MANUAL:'manual'},y={ascending:r({name:'triangle-up',shade:'dark',size:'small'}),descending:r({name:'triangle-down',shade:'dark',size:'small'})};function z(aa,ba,ca,da,ea,fa,ga,ha,ia){"use strict";this.source=aa;if(!ba)return;this._root=ba;this._reorderButton=l.scry(this._root.parentNode,'button.reorderButton').pop();this._id=ba.getAttribute('id');this._ownerID=ia;this._photos={};this._tagger=null;this._options=ga;this._isNamespaced=ha;this._placeholder=ea;this._waitingTemplate=fa;this._mentionsData=ca;this._placesData=da;this._albumPlace=null;this._userDate=null;this._useDateFromFile=false;this._albumCoverListeners={};this._albumCoverTracksFirstPhoto=(this.source===p.FLASH_UPLOADER);this._coverPhotoSortingID=null;if(ga.canReorder)this._initSorting(ga.autosaveReorder);var ja=[h.subscribe(this.mapEventNameToNamespace('PhotosBulkEditablePhoto.INITIALIZED'),this._registerPhoto.bind(this)),h.subscribe([this.mapEventNameToNamespace('PhotosBulkEditablePhoto.REMOVED'),this.mapEventNameToNamespace('PhotosBulkEditablePhoto.ROTATED')],function(ka,la){if(this._sortableGroup){var ma=la.getPhotoData().fbid;this._sortableGroup.removeSortable(ma);}delete this._photos[la.getPhotoDataKey()];}.bind(this)),h.subscribe('PhotosBulkEditor.AUTO_ORDER',this._autoOrder.bind(this)),h.subscribe('PhotosBulkBackdateEditor.SAVED',function(ka,la){this._useDateFromFile=la.useDateFromFile;this._userDate=la.backdatedDate;this._setDate();}.bind(this)),h.subscribe(['PhotoAlbumPlacesTypeahead.SELECTED_PLACE','PhotoAlbumPlacesTypeahead.EXIST_PLACE','PhotoAlbumPlacesTypeahead.RESET_PLACE'],this._setPlace.bind(this)),h.subscribe('PhotosBulkEditablePhoto.MOVED',function(ka,la){if(this.getPhotoData(la))this._photos[la]._doRemove();}.bind(this))];m.listen(this._root,'click',function(ka){var la=o.byClass(ka.getTarget(),'editablePhoto'),ma=this._photos;l.scry(this._root,'.showControls').forEach(function(na){if(la!==na){k.removeClass(na,'showControls');ma[na.id].hideMetadataInputs();}});}.bind(this));n.registerHandler(function(){ja.forEach(function(ka){ka.unsubscribe();});if(this._tagger)this._tagger.done();}.bind(this));}z.prototype.init=function(aa,ba,ca,da,ea,fa){"use strict";z.call(this,this.source,aa,ba,ca,da,ea,fa);};z.prototype.getRoot=function(){"use strict";return this._root;};z.prototype.getSourceString=function(){"use strict";if(this.source===p.BULK_EDITOR){return 'bulk_editor';}else if(this.source===p.FLASH_UPLOADER){return 'flash_uploader';}else return null;};z.prototype.isNamespaced=function(){"use strict";return this._isNamespaced;};z.prototype.getVersionConst=function(){"use strict";return this.source;};z.prototype.getViewerSource=function(){"use strict";return null;};z.prototype.getViewerSet=function(){"use strict";return null;};z.prototype.registerTagger=function(aa){"use strict";this._tagger=aa;};z.prototype.needTaggingData=function(){"use strict";return this._tagger&&this._tagger.needTaggingData();};z.prototype.getPhotoData=function(aa){"use strict";var ba=this._photos[aa];if(ba)return ba.getPhotoData();return {};};z.prototype.getPlaceholder=function(){"use strict";return this._placeholder;};z.prototype.getWaitingTemplate=function(){"use strict";return this._waitingTemplate;};z.prototype.addFaceboxes=function(aa){"use strict";this._tagger&&this._tagger.addFaceboxes(aa);};z.prototype.mapEventNameToNamespace=function(aa){"use strict";return aa+(this._isNamespaced?'/'+this._id:'');};z.prototype._registerPhoto=function(event,aa){"use strict";this._setSortMode(x.MANUAL);this._photos[aa.getPhotoDataKey()]=aa;aa.source=this.source;var ba=aa.getPhotoData(),ca=ba.fbid;if(this._sortableGroup)this._sortableGroup.addSortable(ca,aa.getRoot(),aa.getDragHandle());aa.swapData(this._mentionsData,this._placesData);if(this._sortableGroup)aa.addPlaceSelectHandler(function(){this._sortableGroup.killDrag(ca);}.bind(this));if(this._albumPlace&&!aa.hasOwnPlaceValue())aa.setAlbumPlace(this._albumPlace);if(this._sortableGroup&&this._albumCoverTracksFirstPhoto)this._coverPhotoSortingID=this._sortableGroup.getOrder()[0];};z.prototype._recoverPhotos=function(aa){"use strict";var ba=this._photos;for(var ca in ba){var da=ba[ca];this._tagger.recoverPhoto(da);k.addClass(da.getRoot(),'showRecognitionBoxes');var ea=l.find(da.getRoot(),'div.uiScaledImageContainer.scaledImage');this.addFaceboxes(ea);}};z.prototype._initSorting=function(aa){"use strict";this._setSortMode(x.MANUAL);this._dropCallback=function(ba,ca,da){var ea=this._photos[ca.id].getPhotoData(),fa={order:this._sortableGroup.getOrder(),owner:ea.owner};if(aa){var ga;if(ea.set){fa.set=ea.set;ga='/ajax/photos/sets/static/reorder.php';}else{fa.album_fbid=ea.albumFBID;ga='/ajax/photos/reorder.php';}new i(ga).setData(fa).send();}if(this._sortableGroup&&this._albumCoverTracksFirstPhoto&&this._coverPhotoSortingID!==fa.order[0]){var ha=this._photos[this._sortableGroup.sortables[fa.order[0]].id];if(ha)this._makeAlbumCover(ha);this._coverPhotoSortingID=fa.order[0];}if(!da)this._setSortMode(x.MANUAL);}.bind(this);this._sortableGroup=new q().setDropCallback(this._dropCallback).setBeforeGrabCallback(function(){h.inform(this.mapEventNameToNamespace('PhotosBulkEditor.PHOTO_REORDER_START'));}.bind(this));};z.prototype._compare=function(aa,ba){"use strict";switch(this._sortMode){case x.MANUAL:return this._orderLookup[aa.fbid]<this._orderLookup[ba.fbid];case x.ASCENDING:return aa.timeTaken<ba.timeTaken;case x.DESCENDING:return aa.timeTaken>ba.timeTaken;default:throw new Error('Invalid sort mode');}};z.prototype._setSortMode=function(aa){"use strict";if(!this._reorderButton)return;this._sortMode=aa;var ba=null,ca=(aa!==x.MANUAL);if(ca){ba=u(y[aa]);k.addClass(ba,"_3-8_");}j.setDepressed(this._reorderButton,ca);j.setIcon(this._reorderButton,ba);};z.prototype._autoOrder=function(){"use strict";switch(this._sortMode){case x.MANUAL:var aa,ba,ca=this.getOrder();this._orderLookup={};for(ba=0;ba<ca.length;ba++){aa=ca[ba];this._orderLookup[aa]=ba;}this._setSortMode(x.ASCENDING);break;case x.ASCENDING:this._setSortMode(x.DESCENDING);break;case x.DESCENDING:this._setSortMode(x.MANUAL);break;default:throw new Error('Invalid sort mode');}var da=this._sortableGroup.getOrder().map(function(la){return this._photos['editablePhoto_'+la].getPhotoData();}.bind(this));this._sortableGroup.setDropCallback(w);var ea,fa,ga;for(ea=0;ea<da.length;ea++){fa=ea;for(ga=ea+1;ga<da.length;ga++)if(this._compare(da[ga],da[fa]))fa=ga;if(ea!==fa){var ha=da[fa].fbid,ia=da[ea].fbid;this._sortableGroup.dragOverHandler(ia,ha);this._sortableGroup.dropHandler(ha);da.splice(ea,0,da.splice(fa,1)[0]);}}var ja=Object.keys(this._photos)[0],ka=this._photos[ja];this._dropCallback(ka.getPhotoData().fbid,ka.getRoot(),true);this._sortableGroup.setDropCallback(this._dropCallback);};z.prototype._saveCurrentOrder=function(){"use strict";if(this._photos.length===0)return;var aa=this._sortableGroup.getOrder()[0],ba=(this._photos['editablePhoto_'+aa]||this._photos['photoContainer_'+aa]);if(!ba)return;var ca=ba.getPhotoData();if(!ca.albumFBID)return;var da={order:this._sortableGroup.getOrder(),owner:ca.owner,album_fbid:ca.albumFBID};new i('/ajax/photos/reorder.php').setData(da).send();};z.prototype._setPlace=function(event,aa){"use strict";this._albumPlace=aa||null;var ba=this._options.batchUpdateLocation,ca=[];t(this._photos,function(ea,fa){if(ea.hasOwnPlaceValue())return;ea.setAlbumPlace(this._albumPlace,ba);if(ba)ca.push(ea.getPhotoData().fbid);},this);if(ba){var da=s.getURIBuilder().getURI();if(this._ownerID)da=g.create(da,this._ownerID);new i(da).setData({photo_ids:ca,location:this._albumPlace?this._albumPlace.text:'',location_data:this._albumPlace?this._albumPlace.uid:0}).send();}};z.prototype._setDate=function(){"use strict";var aa='',ba=null,ca;for(var da in this._photos){ca=this._photos[da];if(!this._useDateFromFile){aa=this._userDate.month+'/'+this._userDate.day+'/'+this._userDate.year;ba=new Date(aa).getTime();}ca.setDate(ba,true);}};z.prototype._showAlbumCoverSet=function(aa){"use strict";if(this._albumCover)k.removeClass(this._albumCover,"checked");var ba=l.find(aa.getRoot(),'.albumCover');k.addClass(ba,"checked");this._albumCover=ba;};z.prototype._makeAlbumCover=function(aa){"use strict";new i().setURI('/ajax/photos/album/setcover').setData(aa.getPhotoData()).send();};z.prototype.getOrder=function(){"use strict";if(this._sortableGroup){return this._sortableGroup.getOrder();}else return [];};z.prototype.hasOrder=function(){"use strict";return !!this._sortableGroup;};e.exports=z;},null);
__d("PhotosBulkHeader",["Arbiter","AsyncRequest","DOM","Event","Form","Run","areJSONRepresentationsEqual","goURI","fbt"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){b.__markCompiled&&b.__markCompiled();function p(q,r,s,t){"use strict";this._form=q;this._isAlbum=r;this._editable=s;this._audience=t;this._backdatedTime=null;this._initialData=null;g.subscribe('PhotosBulkBackdateEditor.SAVED',function(u,v){if(!i.contains(this._form.getRoot(),v.context))return;this._backdatedTime=v.backdatedDate;}.bind(this));l.onBeforeUnload(function(){if(this.isDataDirty())return o._("Some of your changes have not been saved. Would you like to save your changes now?");return false;}.bind(this));this._initialData=this.getSerializedData();}p.prototype.getSerializedData=function(){"use strict";var q=k.serialize(this._form.getRoot());if(this._backdatedTime)q.backTime=this._backdatedTime;return q;};p.prototype.isDataDirty=function(){"use strict";return !m(this._initialData,this.getSerializedData());};p.prototype.save=function(q){"use strict";if(!this._editable)return q.call();if(this._audience&&this._audience.removeHiddenPrivacyWidget)this._audience.removeHiddenPrivacyWidget();var r=this._isAlbum?'/ajax/photos/album/edit':'/ajax/photos/sets/edit',s=k.serialize(this._form.getRoot());if(this._backdatedTime)s.backdated_time=this._backdatedTime;new h(r).setData(s).setMethod('POST').setHandler(function(){this._initialData=this.getSerializedData();q();}.bind(this)).send();};p.doneButtonSaveHandler=function(q,r,s){"use strict";var t=q.save.bind(q,function(){n(r);return true;});q._listeners=[j.listen(s,'click',t)];};e.exports=p;},null);