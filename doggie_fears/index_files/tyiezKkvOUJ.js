/*!CK:255792073!*//*1438009844,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["N77PY"]); }

__d("randomShuffle",["randomInt"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();function h(i){for(var j=i.length-1;j>0;j--){var k=g.call(this,j+1);if(k!=j){var l=i[k];i[k]=i[j];i[j]=l;}}return i;}e.exports=h;},null);
__d("AggregatedMapCalloutOrientation",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g={};Object.assign(g,{TOP:'fbMapCalloutUseArrowTop',LEFT:'fbMapCalloutUseArrowLeft',RIGHT:'fbMapCalloutUseArrowRight',BOTTOM:'fbMapCalloutUseArrowBottom',ALWAYS_ON_MAP:'alwaysOnMap'});e.exports=g;},null);
__d("AggregatedMapCallout",["AggregatedMapCalloutOrientation","CSS","DOM","Style","Vector"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();var l=16,m=10,n=10;function o(p,q,r){this.map=p;this.contentContainer=null;this.width=null;this.height=null;this.anchor=null;this.orientation=g.RIGHT;this.arrowYOffset=null;this.arrowXOffset=null;this.border=q;this.contentContainer=i.find(this.border,'.fbMapCalloutContent');this.arrowWrap=i.find(this.border,'.fbMapCalloutArrowWrap');this.arrowL=i.find(this.border,'.fbMapCalloutArrowLeft');this.arrowR=i.find(this.border,'.fbMapCalloutArrowRight');this.arrowT=i.find(this.border,'.fbMapCalloutArrowTop');this.arrowB=i.find(this.border,'.fbMapCalloutArrowBottom');this._updateDimensions();}Object.assign(o.prototype,{setOrientation:function(p){this.orientation=p;},getOrientation:function(){return this.orientation;},getRoot:function(){return this.border;},getAnchor:function(){return this.anchor;},close:function(){this.anchor=null;this._map_updatePosition();},updateAnchor:function(p){this.anchor=p;this._map_updatePosition();},setContent:function(p){i.setContent(this.contentContainer,p);this._updateDimensions();},getContent:function(){return this.contentContainer;},recalculateArrowYOffset:function(p){if(!this.anchor)return;var q=this.map._callout_determineArrowYOffset(this,p,this.width,this.height);this.setArrowYOffset(q);this._map_updatePosition();},_updateDimensions:function(){h.show(this.border);this.width=k.getElementDimensions(this.border).x;this.height=k.getElementDimensions(this.border).y;this.setArrowXOffset(this.width/2);this.setArrowYOffset(this.height/2);h.hide(this.border);},_map_moveTo:function(p,q){this.anchor=p;this.map._callout_panTo(p,this,q);this._map_updatePosition();},_map_updatePosition:function(){var p=this.anchor&&this.map._callout_getAnchorBounds(this.anchor);if(p===null){h.hide(this.border);return;}var q,r,s,t,u=m,v=this.orientation;if(this.orientation===g.ALWAYS_ON_MAP){var w=p.getCenter().x,x=p.getCenter().y;if(w<0&&x<0){r=n;q=n;}else if(w>this.map.ww&&x<0){s=n;q=n;}else if(w>this.map.ww&&x>this.map.hh){s=n;t=n;}else if(w<0&&x>this.map.hh){r=n;t=n;}else if(w<0){v=g.RIGHT;r=n;q=p.calloutY-this.arrowYOffset;}else if(w>this.map.ww){v=g.LEFT;s=n;q=p.calloutY-this.arrowYOffset;}else if(x<0){v=g.BOTTOM;q=n;r=(p.l+p.r)/2-this.arrowXOffset;}else if(x>this.map.hh){v=g.TOP;t=n;r=(p.l+p.r)/2-this.arrowXOffset;}else{q=p.calloutY-this.arrowYOffset;if(w<this.map.ww/2){r=p.r+u;v=g.RIGHT;}else{r=p.l-u-this.width;v=g.LEFT;}}}switch(this.orientation){case g.LEFT:r=p.l-u-this.width;q=p.calloutY-this.arrowYOffset;break;case g.RIGHT:r=p.r+u;q=p.calloutY-this.arrowYOffset;break;case g.TOP:t=this.map._getH()-p.t+u;r=(p.l+p.r)/2-this.arrowXOffset;break;case g.BOTTOM:q=p.b+u;r=(p.l+p.r)/2-this.arrowXOffset;break;}h.setClass(this.arrowWrap,v);this._setPosition('top',q);this._setPosition('right',s);this._setPosition('bottom',t);this._setPosition('left',r);h.show(this.border);},_setPosition:function(p,q){if(q!==(void 0)){q+='px';}else q='auto';j.set(this.border,p,q);},setArrowXOffset:function(p){this.arrowXOffset=p;p-=Math.round(l/2);j.set(this.arrowT,'left',p+'px');j.set(this.arrowB,'left',p+'px');},setArrowYOffset:function(p){this.arrowYOffset=p;p-=Math.round(l/2);j.set(this.arrowL,'top',p+'px');j.set(this.arrowR,'top',p+'px');}});Object.assign(o,{throbber:function(p){p=p||this.DEFAULT_CALLOUT_WIDTH;var q=i.create('div',{}),r=i.create('img',{src:'/images/loaders/indicator_blue_small.gif'});h.setClass(q,'fbAggregatedMapCalloutThrobberDiv');j.set(q,'width',p+'px');h.setClass(r,'fbAggregatedMapCalloutThrobber');i.setContent(q,r);return q;},ARROW_HEIGHT_PLUS_PADDING:m,ARROW_WIDTH:l});e.exports=o;},null);
__d("AggregatedMapMarker",["DOM","Style"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();function i(j,k){this._root=j;this._sprite=k;}Object.assign(i.prototype,{setPosition:function(j){var k=j.y-this._sprite.getAnchorY(),l=j.x-this._sprite.getAnchorX();h.set(this._root,'top',Math.round(k)+'px');h.set(this._root,'left',Math.round(l)+'px');},setOnClick:function(j){this._root.onclick=j;},setOnMouseover:function(j){this._root.onmouseover=j;},setOnMouseout:function(j){this._root.onmouseout=j;},remove:function(){g.remove(this._root);},getElement:function(){return this._root;}});e.exports=i;},null);
__d("AggregatedMapZIndex",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g={};Object.assign(g,{DEFAULT_PIN_BASE_Z_INDEX:1000,PIN_Z_INDEX_MAXIUMUM_ADD:4000,DEFAULT_PIN_MAX_Z_INDEX:5000,CONTROLS_Z_INDEX:7000,CALLOUT_Z_INDEX:9000,TOOLTIP_Z_INDEX:9100});e.exports=g;},null);
__d("MapRects",["Rect","Vector","confine"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();function j(){}Object.assign(j,{containsPoint:function(k,l,m){if(m===(void 0))m=0;return k.t<=l.y+m&&k.r>=l.x-m&&k.b>=l.y-m&&k.l<=l.x+m;},pad:function(k,l){return j.padXY(k,l,l);},padX:function(k,l){return j.padXY(k,l,0);},padY:function(k,l){return j.padXY(k,0,l);},padXY:function(k,l,m){return new g(k.t-m,k.r+l,k.b+m,k.l-l,k.domain);},collides:function(k,l){return (k.t<l.b&&k.b>l.t&&k.l<l.r&&k.r>l.l);},boundPoint:function(k,l){var m=new h(0,0);m.x=i(l.x,k.l,k.r);m.y=i(l.y,k.t,k.b);return m;},boundingBox:function(k,l){return new g(Math.min(k.t,l.t),Math.max(k.r,l.r),Math.max(k.b,l.b),Math.min(k.l,l.l));},scale:function(k,l,m){return new g(k.t*l/m,k.r*l/m,k.b*l/m,k.l*l/m);}});e.exports=j;},null);
__d("BingMaps",["MapRects","Rect","Vector","confine","mod"],function(a,b,c,d,e,f,g,h,i,j,k){b.__markCompiled&&b.__markCompiled();function l(){}Object.assign(l,{MIN_LATITUDE:-85.05112878,MAX_LATITUDE:85.05112878,MIN_LONGITUDE:-180,MAX_LONGITUDE:180,pows:{},MAX_ZOOM:20,BING_MAP_ZOOM_LEVEL_CITY:12,EARTH_CIRCUMFERENCE_METERS:40074784,scale:function(m,n){var o=n-m;if(!l.pows[o])l.pows[o]=Math.pow(2,o);return l.pows[o];},mapSize:function(m){return 512*l.scale(1,m);},latLongToXY:function(m,n){var o=j(m.latitude,l.MIN_LATITUDE,l.MAX_LATITUDE),p=(m.longitude+180)/360,q=Math.sin(o*Math.PI/180),r=.5-Math.log((1+q)/(1-q))/(4*Math.PI),s=l.mapSize(n);return new i(Math.floor(p*(s-1)+.5),Math.floor(r*(s-1)+.5));},xyToLatLong:function(m,n){var o=l.mapSize(n),p=k(m.x,o)/o-.5,q=.5-(j(m.y,0,o-1)/o),r=90-360*Math.atan(Math.exp(-q*2*Math.PI))/Math.PI,s=360*p;return {latitude:r,longitude:s};},getViewForLatLongs:function(m,n,o,p,q,r){if(!o.length)throw new Error('the proper view for zero point(s) is completely ambiguous');p=p||new h(0,0,0,0);q=q||1;r=r||Infinity;var s=l._getBoundingBox(o),t=p.l+p.r,u=p.t+p.b,v=l.MAX_ZOOM,w;if(o.length>1){w=l.mapSize(v);while((v>q&&(l._getWidth(s,w)>m-t||s.h()>n-u)||v>r)){s=g.scale(s,1,2);v--;w=l.mapSize(v);}}else while(v!==l.BING_MAP_ZOOM_LEVEL_CITY){v--;s=g.scale(s,1,2);}var x=s.l-p.l,y=s.r+p.r;if(y<x)y+=l.mapSize(v);var z=new h(s.t-p.t,y,s.b+p.b,x);w=l.mapSize(v);var aa=new i(z.getCenter().x,z.getCenter().y),ba=l.xyToLatLong(aa,v);return {center:ba,width:m,height:n,zoom:v};},_getWidth:function(m,n){return l._calculateRightDistanceAToB(m.l,m.r,n);},_getBoundingBox:function(m){var n=[],o=l.mapSize(l.MAX_ZOOM);for(var p=0;p<m.length;p++){var q=m[p];n.push(l.latLongToXY(q,l.MAX_ZOOM));}n.sort(function(z,aa){return z.x-aa.x;});var r=n.length-1,s=l._calculateRightDistanceAToB(n[r].x,n[0].x,o),t=0,u=r,v=[n[0].y],w;for(var x=1;x<n.length;x++){v.push(n[x].y);var y=l._calculateRightDistanceAToB(n[x-1].x,n[x].x,o);if(y>s){s=y;t=x;u=x-1;}}w=new h(Math.min.apply(null,v),n[u].x,Math.max.apply(null,v),n[t].x);return w;},_calculateRightDistanceAToB:function(m,n,o){if(!o)throw new Error('zero or null map width not allowed');return (o+n-m)%o;}});e.exports=l;},null);
__d("BingMapCoordinate",["BingMaps","Vector","mod"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();function j(){this.absoluteX=null;this.absoluteY=null;this.latitude=null;this.longitude=null;}Object.assign(j,{MAX_ZOOM:18,MIN_ZOOM:1,fromAbsolute:function(k,l){if(l===(void 0)){l=k.y;k=k.x;}var m=new j();m.absoluteX=k;m.absoluteY=l;var n=g.xyToLatLong(new h(k,l),j.MAX_ZOOM);m.latitude=n.latitude;m.longitude=n.longitude;return m;},fromLatLong:function(k,l){if(l===(void 0)){l=k.longitude;k=k.latitude;}var m=new j();m.latitude=k;m.longitude=l;var n=g.latLongToXY({latitude:k,longitude:l},j.MAX_ZOOM);m.absoluteX=n.x;m.absoluteY=n.y;return m;},fromMap:function(k,l,m){var n=g.scale(m,j.MAX_ZOOM);return j.fromAbsolute(k*n,l*n);}});Object.assign(j.prototype,{getLatitude:function(){return this.latitude;},getLongitude:function(){return this.longitude;},getAbsoluteX:function(){return this.absoluteX;},getAbsoluteY:function(){return this.absoluteY;},getAbsoluteXY:function(){return new h(this.absoluteX,this.absoluteY);},getMapX:function(k){return this.getMapXY(k).x;},getMapY:function(k){return this.getMapXY(k).y;},getMapXY:function(k){var l=g.scale(j.MAX_ZOOM,k),m=this.absoluteX*l,n=this.absoluteY*l;return new h(m,n);},add:function(k,l){var m=this.getMapXY(k);return j.fromMap(m.x+l.x,m.y+l.y,k);},calculateDistanceSq:function(k,l){var m=this.calculateDistanceX(k,l),n=this.calculateDistanceY(k,l);return m*m+n*n;},calculateDistanceX:function(k,l){var m=g.mapSize(k),n=i(l.getMapX(k)-this.getMapX(k),m);return Math.min(n,m-n);},calculateDistanceY:function(k,l){return Math.abs(l.getMapY(k)-this.getMapY(k));}});e.exports=j;},null);
__d("AggregatedMapGroup",["AggregatedMapMarker","AggregatedMapZIndex","BingMapCoordinate","DOM","Rect","Style","confine"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();function n(o,p,q,r){this._boundingBox=p;this._sprite=q;this._marker=null;this._mapToPixel=r;this.pins=o;this.deleted=false;}Object.assign(n.prototype,{getType:function(){return 'AggregatedMapGroup';},getCenter:function(){return this._mapToPixel(this._boundingBox.getCenter());},getCenterLatLong:function(o){var p=this._boundingBox.getCenter(),q=i.fromMap(p.x,p.y,o);return {latitude:q.getLatitude(),longitude:q.getLongitude()};},hasMarker:function(){return !!this._marker;},dismissMarker:function(){if(this._marker){this._marker.remove();this._marker=null;}},getMarker:function(){return this._marker&&this._marker.getElement();},getSprite:function(){return this._sprite;},updatePosition:function(o){if(!this._marker)return;var p=this.getCenter();this._marker.setPosition(p);},getSpriteBounds:function(){var o=this._sprite,p=this.getCenter().y-o.getAnchorY(),q=this.getCenter().x-o.getAnchorX(),r=q+o.getWidth(),s=p+o.getHeight(),t=new k(p,r,s,q);t.calloutY=p+o.getCalloutY();return t;},isSinglePin:function(){return this.pins.length==1;},renderMarker:function(o){if(!this._marker){var p=this._sprite,q=p.render();this._marker=new g(q,this._sprite);if(this.isSinglePin()){var r=(p.getBaseZIndex&&p.getBaseZIndex())||h.DEFAULT_PIN_BASE_Z_INDEX;r+=m(Math.floor(this.getCenter().y),0,h.PIN_Z_INDEX_MAXIUMUM_ADD);if(p.setZIndex){p.setZIndex(Math.floor(r));}else l.set(q,'z-index',Math.floor(r));}j.appendContent(o,q);}return this._marker;},add:function(o,p){return this._boundingBox.add(o,p);}});e.exports=n;},null);
__d("MapAggregation",["removeFromArray"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();function h(){this.combine=null;this.iterations=0;this.candidates=null;this.loners=null;}Object.assign(h.prototype,{aggregate:function(i,j,k){this.overlap=k?k:this._overlap;this.candidates=i;this.combine=j;this.loners=[];while(this.candidates.length>0){var l=this.candidates[this.candidates.length-1],m;do{var n=l.center;this._group(l,Number.MAX_VALUE);m=n!==l.center;}while(!this._isDeleted(l)&&m);if(!this._isDeleted(l)){g(this.candidates,l);this.loners.push(l);}}return this.loners;},_isDeleted:function(i){return i.center===null;},_delete:function(i){g(this.candidates,i);g(this.loners,i);i.center=null;},_group:function(i,j){while(true){this.iterations++;if(this.iterations>=10000){this.iterations%10000===0&&0;return;}var k=this._nearest(i),l=k.nearest,m=k.distanceSquared;if(!l||m>j||!this.overlap(i,l))return;var n=l.center,o=i.center;this._group(l,m-1);if(this._isDeleted(i))return;var p=l.center!==n,q=i.center!==o;if(!p&&!q){this.combine(i,l);this._delete(l);return;}}},_nearest:function(i){var j,k,l,m=null,n=Number.MAX_VALUE;for(j=0;j<this.candidates.length;j++){l=this.candidates[j];if(l===i)continue;k=this._distanceSquared(i,l);if(k<n){m=l;n=k;}}for(j=0;j<this.loners.length;j++){l=this.loners[j];if(l===i)continue;k=this._distanceSquared(i,l);if(k<n){m=l;n=k;}}return {nearest:m,distanceSquared:n};},_overlap:function(i,j){var k=i.radius+j.radius;return this._distanceSquared(i,j)<k*k;},_distanceSquared:function(i,j){var k=i.center.x-j.center.x,l=i.center.y-j.center.y;return k*k+l*l;}});e.exports=h;},null);
__d("AggregatedMap",["Event","AggregatedMapCallout","AggregatedMapCalloutOrientation","AggregatedMapGroup","AggregatedMapZIndex","Arbiter","BingMapCoordinate","BingMaps","CSS","DOM","GeoRectangle","MapAggregation","MapRects","Rect","Run","Style","Vector","confine","csx","$"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z){b.__markCompiled&&b.__markCompiled();var aa=10,ba=7,ca=100,da=50,ea=500,fa=409,ga=90,ha=90,ia=.15,ja=10,ka=10,la=10,ma=new t(50,50,50,50);function na(oa,pa,qa,ra,sa,ta,ua){this.mapReady=false;this.lastZoom=null;this.initialView=null;this.lastRender=null;this.visiblePins=[];this.groups=[];this.callouts=[];this.zoomStack=[];this.initialPinsToHide=[];this.arrowYOffset=ha;this.padding=ca+da;this.topLeft=m.fromLatLong(0,0);this.dynamicMap=oa;this.canvas=pa;this.instanceid=qa;this.logger=ta;this.maxZoom=ra.maxZoom;this.minZoom=ra.minZoom;this.maxCalloutWidth=ra.maxCalloutWidth||ra.width-aa;this.maxCalloutHeight=ra.maxCalloutHeight||ra.height-aa;this.pad={};this.setViewportPadding(ra.paddingTop,ra.paddingRight,ra.paddingBottom,ra.paddingLeft);this.listeners=[];this.bingMapEvents=[];u.onLeave(this._onBeforeLeave.bind(this));this.dynamicMap.onInit(this._onInit.bind(this,sa,ua));}Object.assign(na.prototype,{CALLOUT_MARGIN:10,noPanningStrategy:function(oa){return this._noPan.bind(this,oa);},leftRightNoPanningStrategy:function(){return this._leftRightNoPan.bind(this);},anchoredPanningStrategy:function(oa,pa){return this._anchoredPan.bind(this,oa,pa);},smartPanningStrategy:function(oa,pa){return this._smartPan.bind(this,oa,pa);},getMap:function(){this._assertInitialized();return this.map;},getMicrosoftMaps:function(){this._assertInitialized();return this.microsoftMaps;},setPins:function(oa){this._assertInitialized();this.visiblePins=oa;this.calloutAnchor=null;this._setZoomButtonVisibility();this._aggregate();},getGroups:function(){return this.groups;},getWidth:function(){return this._getW()-this.pad.l-this.pad.r;},getAbsoluteWidth:function(){return this._getW();},getHeight:function(){return this._getH()-this.pad.t-this.pad.b;},getAbsoluteHeight:function(){return this._getH();},getBounds:function(){var oa=n.xyToLatLong(this.dynamicMap.pixelToMap(new w(this.pad.l,this.pad.t)),this.getZoom()),pa=n.xyToLatLong(this.dynamicMap.pixelToMap(new w(this._getW()-this.pad.r,this._getH()-this.pad.b)),this.getZoom());return new q(oa.latitude,oa.longitude,pa.latitude,pa.longitude);},pushView:function(){this._assertInitialized();this.zoomStack.push(this._getMapView());},invalidateSize:function(){this.dynamicMap.invalidateSize();},zoomIntoOne:function(oa,pa){this._assertInitialized();this.pushView();this.zoomToOne(oa,pa);},zoomToOne:function(oa,pa,qa){this.zoomToOneTight(oa,pa,0,qa);},zoomToOneTight:function(oa,pa,qa,ra){this._assertInitialized();pa=pa||new w(0,0);qa=qa||0;ra=ra||false;qa=Math.max(this._findMinZoomWherePinIsAlone(oa),qa,this.getZoom());oa.setZoom(qa);var sa=oa.anchor.add(qa,pa.mul(-1));this._setMapView({zoom:qa,center:{latitude:sa.getLatitude(),longitude:sa.getLongitude()},animate:ra},l.BEHAVIOR_PERSISTENT);},zoomInto:function(oa){this._assertInitialized();this.pushView();this.zoomTo(oa);},removePin:function(oa){this._assertInitialized();this.removePins([oa]);},removePins:function(oa){this._assertInitialized();for(var pa=0;pa<oa.length;pa++)oa[pa]._aggregated_map_remove=true;var qa=[];for(var ra=0;ra<this.visiblePins.length;ra++)if(!this.visiblePins[ra]._aggregated_map_remove)qa.push(this.visiblePins[ra]);for(var sa=0;sa<oa.length;sa++)delete oa[sa]._aggregated_map_remove;this.visiblePins=qa;this._aggregate();},addPins:function(oa){this._assertInitialized();this.visiblePins=this.visiblePins||[];for(var pa=0;pa<oa.length;pa++)this.visiblePins.push(oa[pa]);this._aggregate();},addPin:function(oa){this._assertInitialized();this.addPins([oa]);},zoomOut:function(){this._assertInitialized();this.logger&&this.logger.bumpTap('zoom-out');this.zoomDelta(-1,true);},zoomIn:function(){this._assertInitialized();this.logger&&this.logger.bumpTap('zoom-in');this.zoomDelta(1,true);},zoomBack:function(){this._assertInitialized();this.logger&&this.logger.bumpTap('snap-back');var oa;if(this.zoomStack.length){oa=this.zoomStack.pop();}else{oa={};Object.assign(oa,this.initialView);oa.zoom=Math.min(oa.zoom,this.getZoom());}this._setMapView(oa);},setInitialView:function(){this._assertInitialized();this.initialView=this._getMapView();var oa=p.scry(this.canvas,"span.__0")[0];oa&&o.hide(oa);},closeCalloutAndZoomBack:function(){this._assertInitialized();this.hideCallout();this.zoomBack();},onAddPin:function(oa,pa){var qa=pa.pin,ra=pa.content;this.hideCallout();this.addPin(qa);this.zoomIntoOne(qa);this.openCallout(qa,ra);},zoomDelta:function(oa,pa){oa=x(this.getZoom()+oa,this.minZoom,this.maxZoom)-this.getZoom();if(!oa)return;var qa=null;if(pa&&this._getPrimaryCalloutAnchorGroup()){qa=this._getPrimaryCalloutAnchorGroup().getCenter();var ra=!s.containsPoint(new t(0,this._getW(),this._getH(),0),qa);if(ra)qa=null;}if(qa===null)qa={x:this._getW()/2+this._getCenterOffset().x,y:this._getH()/2+this._getCenterOffset().y};var sa=this.map.tryPixelToLocation(new this.microsoftMaps.Point(qa.x,qa.y),this.microsoftMaps.PixelReference.control),ta=new this.microsoftMaps.Point(qa.x-this.map.getWidth()/2,qa.y-this.map.getHeight()/2);this._zoom(true,oa,sa,ta);},getZoom:function(){return this.map.getZoom();},getCenter:function(){return this.map.getCenter();},getView:function(){return this._getMapView();},setView:function(oa){this._assertInitialized();this._setMapView(oa);},setViewportPadding:function(oa,pa,qa,ra){this.pad.t=oa;this.pad.r=pa;this.pad.b=qa;this.pad.l=ra;},redraw:function(){this._assertInitialized();this._aggregate();},zoomTo:function(oa,pa){this._assertInitialized();if(oa.length<1)return;var qa=this.maxZoom;if(oa.length<ja)while(this._aggregateZoom(oa,qa-1).length==oa.length&&qa>=ka)qa--;var ra=[];for(var sa=0;sa<oa.length;sa++){var ta={latitude:oa[sa].getLatitude(),longitude:oa[sa].getLongitude()};ra.push(ta);}var ua=n.getViewForLatLongs(this._getW(),this._getH(),ra,ma,this.minZoom,qa);delete ua.height;delete ua.width;ua.animate=pa;this._setMapView(ua,l.BEHAVIOR_PERSISTENT);},hideCallout:function(oa){this._assertInitialized();var pa=this._getPrimaryCalloutAnchor();this._getInternalCallout().close();if(pa&&!oa)this._inform('calloutHidden');},throbber:function(oa){oa=oa||fa;return h.throbber(oa);},openCallout:function(oa,pa,qa){if(this._getTooltipCallout().getAnchor()===oa)this._getTooltipCallout().close();this._getInternalCallout().setContent(pa);this._getInternalCallout()._map_moveTo(oa,qa);return this._getInternalCallout();},getCallout:function(){return this._getInternalCallout();},setExternalCalloutAnchor:function(oa){this._externalCalloutAnchor=oa;},openTooltip:function(oa,pa,qa){if(this._getInternalCallout().getAnchor()===oa)return;this._getTooltipCallout().setContent(pa);this._getTooltipCallout()._map_moveTo(oa,qa);return this._getTooltipCallout();},getTooltip:function(){return this._getTooltipCallout();},updateCallouts:function(){for(var oa=0;oa<this.callouts.length;oa++)this.callouts[oa]._map_updatePosition();},_onInit:function(oa,pa){this.microsoftMaps=this.dynamicMap.getMicrosoftMaps();this.map=this.dynamicMap.getMap();this.bingMapEvents=[this.microsoftMaps.Events.addHandler(this.map,'viewchange',this._onViewChange.bind(this)),this.microsoftMaps.Events.addHandler(this.map,'dblclick',this._onDoubleClick.bind(this)),this.microsoftMaps.Events.addHandler(this.map,'viewchangeend',this._onViewChangeEnd.bind(this)),this.microsoftMaps.Events.addHandler(this.map,'mouseup',this._onMouseUp.bind(this)),this.microsoftMaps.Events.addHandler(this.map,'mousedown',this._onMouseDown.bind(this)),this.microsoftMaps.Events.addHandler(this.map,'zoomstart',this._onZoomStart.bind(this))];this._onViewChange();this.initialized=true;for(var qa=0;qa<oa.length;qa++)oa[qa].xhp&&this.initialPinsToHide.push(oa[qa].xhp);oa.length&&this.setPins(oa);if(pa){oa[0].setCallout(z(pa));this._getInternalCallout()._map_moveTo(oa[0],this.noPanningStrategy(i.TOP));}o.hide(p.scry(this.canvas,'.fbAggregatedMapCalloutShell')[0]);for(var ra in na.Listeners)this._subscribe('AggregatedMap/'+ra,this[ra].bind(this));this._inform(na.Events.ready,this,l.BEHAVIOR_STATE);},_callout_getAnchorBounds:function(oa){var pa=this._getCalloutAnchorGroup(oa),qa=pa&&pa.getSpriteBounds();return qa;},_callout_panTo:function(oa,pa,qa){var ra=this._callout_getAnchorBounds(oa),sa=qa?qa(pa,ra):null;if(sa){var ta=n.xyToLatLong(this.dynamicMap.pixelToMap(sa),this.getZoom());this._setMapView({center:ta});}},_callout_determineArrowYOffset:function(oa,pa,qa,ra){var sa=this._callout_getAnchorBounds(oa.getAnchor()),ta=new w((sa.l+sa.r)/2,sa.calloutY),ua=ra/2,va=this._getVisibleBounds(),wa=s.containsPoint(this._getNoPanBounds(ra),ta,1),xa=ua;if(pa||wa){var ya=va.t+ua+this.CALLOUT_MARGIN,za=va.b-(ra-ua)-this.CALLOUT_MARGIN;xa+=ta.y-x(ta.y,ya,za);}xa=x(xa,h.ARROW_WIDTH/2,ra-h.ARROW_WIDTH/2);return xa;},_createCallout:function(oa){var pa=p.scry(this.canvas,'.fbAggregatedMapCalloutShell')[0],qa=pa.cloneNode(true);p.appendContent(this.canvas,qa);v.set(qa,'z-index',oa);var ra=new h(this,qa);this.callouts.push(ra);return ra;},_getInternalCallout:function(){this.internalCallout=this.internalCallout||this._createCallout(k.CALLOUT_Z_INDEX);return this.internalCallout;},_getTooltipCallout:function(){this.tooltipCallout=this.tooltipCallout||this._createCallout(k.TOOLTIP_Z_INDEX);return this.tooltipCallout;},_assertInitialized:function(){},_guard:function(oa){return function(pa,qa){if(!(!qa||!qa._instanceid))if(qa._instanceid===this.instanceid)return oa(pa,qa);}.bind(this);},_subscribe:function(oa,pa){this.listeners.push(l.subscribe(oa,this._guard(pa)));},_inform:function(oa,pa,qa){pa=pa||{};pa._instanceid=this.instanceid;l.inform('AggregatedMap/'+oa,pa,qa);},_bubbleClick:function(oa){this._inform(na.Events.bubbleClick,oa);},_bubbleMouseover:function(oa){this._inform(na.Events.bubbleMouseover,oa);},_bubbleMouseout:function(oa){this._inform(na.Events.bubbleMouseout,oa);},_pinClick:function(oa){if(oa._agg_map_callout)if(this.getCallout().getAnchor()===oa){this.hideCallout();}else this.openCallout(oa,oa._agg_map_callout);this._inform(na.Events.pinClick,oa);},_pinMouseover:function(oa){if(oa.name){var pa=p.create('span');o.addClass(pa,'fbAggregatedMapTooltipText');p.setContent(pa,oa.name);this.openTooltip(oa,pa,this.leftRightNoPanningStrategy());}this._inform(na.Events.pinMouseover,oa);},_pinMouseout:function(oa){if(this.tooltipCallout&&this.tooltipCallout.getAnchor()===oa&&oa.name)this.tooltipCallout.close();this._inform(na.Events.pinMouseout,oa);},_getVisibleBounds:function(){return new t(this.pad.t,this._getW()-this.pad.r,this._getH()-this.pad.b,this.pad.l);},_getCenterOffset:function(){return {x:(this.pad.l-this.pad.r)/2,y:(this.pad.t-this.pad.b)/2};},_setMapView:function(oa,pa){var qa=this._getCenterOffset();if(oa.centerOffset){qa.x+=oa.centerOffset.x;qa.y+=oa.centerOffset.y;}oa.centerOffset=new this.microsoftMaps.Point(qa.x,qa.y);if(oa.center)oa.center=new this.microsoftMaps.Location(oa.center.latitude,oa.center.longitude);this.map.setView(oa);},_findMinZoomWherePinIsAlone:function(oa){if(this.visiblePins.length<2)return this.minZoom;var pa=Number.MAX_VALUE,qa=null,ra=oa.anchor.getAbsoluteXY();for(var sa=0;sa<this.visiblePins.length;sa++){var ta=this.visiblePins[sa],ua=ta.anchor.getAbsoluteXY().distanceTo(ra);if(ua<pa&&ta!==oa){pa=ua;qa=ta;}}var va=oa.getAggregationRadius()+qa.getAggregationRadius(),wa=this.maxZoom;while(pa/2>va&&wa>this.minZoom){wa--;pa/=2;}while(wa<this.maxZoom){var xa=this._aggregateZoom(this.visiblePins,wa),ya=false;for(var za=0;za<xa.length;za++){var ab=xa[za];if(ab.members.length==1&&ab.members[0]===oa)return wa;}wa++;}return wa;},_smartPan:function(oa,pa,qa,ra){oa=oa||this.maxCalloutWidth;pa=pa||this.maxCalloutHeight;var sa=s.pad(this._getNoPanBounds(pa),ea-this.CALLOUT_MARGIN),ta=new w(ra.getCenter().x,ra.calloutY);if(s.containsPoint(sa,ta)){var ua=this._getVisibleBounds(),va=ta.sub(s.boundPoint(this._getNoPanBounds(pa),ta)),wa=ra.w()/2+h.ARROW_HEIGHT_PLUS_PADDING+oa+this.CALLOUT_MARGIN;if(ta.x>ua.getCenter().x){qa.setOrientation(i.LEFT);if(!va.x)va.x=ta.x-Math.max(ta.x,wa+ua.l);}else{qa.setOrientation(i.RIGHT);if(!va.x)va.x=ta.x-Math.min(ta.x,ua.r-wa);}var xa=null;if(va.magnitude()>=1)xa=new w(this._getW()/2+va.x+this._getCenterOffset().x,this._getH()/2+va.y+this._getCenterOffset().y);return xa;}return this._anchoredPan(na.Anchor.DEFAULT,i.RIGHT,this._getInternalCallout(),ra);},_leftRightNoPan:function(oa,pa){if(pa.getCenter().x>this._getVisibleBounds().getCenter().x){oa.setOrientation(i.LEFT);}else oa.setOrientation(i.RIGHT);},_noPan:function(oa,pa,qa){pa.setOrientation(oa);},_anchoredPan:function(oa,pa,qa,ra){var sa=this._getVisibleBounds();qa.setOrientation(pa);if(oa===na.Anchor.DEFAULT)oa=new w(sa.getCenter().x-this.maxCalloutWidth/2-ra.w()/2,sa.getCenter().y-ia*this._getH()-ha+h.ARROW_WIDTH/2);return ra.getCenter().sub(oa).add(new w(this._getW()/2,this._getH()/2));},_renderOverlay:function(){if(!this.mapReady)return;this.lastRender=this.topLeft;var oa,pa=new t(-this.padding,this._getW()+this.padding,this._getH()+this.padding,-this.padding);for(var qa=0;qa<this.groups.length;qa++){oa=this.groups[qa];var ra=oa.getCenter();if(s.containsPoint(pa,ra)){var sa=oa.renderMarker(this.canvas);if(oa.pins.length>1){sa.setOnClick(this._bubbleClick.bind(this,oa));sa.setOnMouseover(this._bubbleMouseover.bind(this,oa));sa.setOnMouseout(this._bubbleMouseout.bind(this,oa));}else{sa.setOnClick(this._pinClick.bind(this,oa.pins[0]));sa.setOnMouseover(this._pinMouseover.bind(this,oa.pins[0]));sa.setOnMouseout(this._pinMouseout.bind(this,oa.pins[0]));}}else oa.dismissMarker();}this._position();while(this.initialPinsToHide.length)o.hide(this.initialPinsToHide.pop());},_getNoPanBounds:function(oa){var pa=this._getVisibleBounds();return s.pad(new t(pa.t+ga,pa.r,pa.b-ga,pa.l),-this.CALLOUT_MARGIN);},_getCalloutAnchorGroup:function(oa){return oa&&(oa.group||oa);},_getPrimaryCalloutAnchor:function(){return this._getInternalCallout().getAnchor()||this._externalCalloutAnchor;},_getPrimaryCalloutAnchorGroup:function(){return this._getCalloutAnchorGroup(this._getPrimaryCalloutAnchor());},_zoom:function(oa,pa,qa,ra){pa=Math.max(m.MIN_ZOOM,Math.min(this.getZoom()+pa,m.MAX_ZOOM));this.map.setView({animate:oa,zoom:pa,center:qa,centerOffset:ra});},_getMapView:function(){return {center:this.map.getCenter(),zoom:this.map.getZoom(),width:this.map.getWidth(),height:this.map.getHeight()};},_setZoomButtonVisibility:function(){var oa=p.scry(this.canvas,"label.__1")[0],pa=p.scry(this.canvas,"label.__2")[0];oa&&o.conditionClass(oa,"uiButtonDisabled",this.getZoom()>=this.maxZoom);pa&&o.conditionClass(pa,"uiButtonDisabled",this.getZoom()<=this.minZoom);},_aggregate:function(){this.logger&&this.logger.startRun('_aggregate');var oa,pa=this._aggregateZoom(this.visiblePins,this.getZoom()),qa=[];for(var ra=0;ra<pa.length;ra++){var sa=pa[ra];oa=new j(sa.members,sa.rect,sa.sprite,this.dynamicMap.mapToPixel.bind(this.dynamicMap));qa.push(oa);for(var ta=0;ta<sa.members.length;ta++)sa.members[ta].group=oa;}for(var ua=0;ua<this.groups.length;ua++){oa=this.groups[ua];oa.dismissMarker();oa.deleted=true;}for(var va=0;va<this.callouts.length;va++)if(this.callouts[va].getAnchor()&&this.callouts[va].getAnchor().getType()==='AggregatedMapGroup')this.callouts[va].close();this.groups=qa;this._renderOverlay();this.logger&&this.logger.endRun('_aggregate');},_combine:function(oa,pa){for(var qa=0;qa<pa.members.length;qa++)oa.members.push(pa.members[qa]);oa.rect=s.boundingBox(oa.rect,pa.rect);oa.sprite=oa.sprite.combine(pa.sprite);oa.radius=oa.sprite.getAggregationRadius();oa.center=oa.rect.getCenter();oa.single=0;return oa;},_overlap:function(oa,pa){var qa=oa.center.y-pa.center.y,ra=oa.center.x-pa.center.x;if(oa.single+pa.single==1)if(oa.single&&qa>ba/2){qa-=ba;}else if(pa.single&&-qa<ba/2)qa+=ba;var sa=oa.radius+pa.radius;return ra*ra+qa*qa<sa*sa;},_aggregateZoom:function(oa,pa){for(var qa=0;qa<oa.length;qa++){oa[qa].setZoom(pa);var ra=oa[qa].center;oa[qa].rect=new t(ra.y,ra.x,ra.y,ra.x);oa[qa].single=1;}var sa=[],ta=[];for(var ua=0;ua<oa.length;ua++){var va=oa[ua],wa={};Object.assign(wa,va);wa.radius=va.getAggregationRadius();wa.members=[va];if(wa.radius){sa.push(wa);}else ta.push(wa);}if(pa<this.maxZoom&&sa.length>1)sa=new r().aggregate(sa,this._combine.bind(this),this._overlap.bind(this));return sa.concat(ta);},_position:function(){this.logger&&this.logger.startRun('_position');var oa=this._getW()/2;for(var pa=0;pa<this.groups.length;pa++)this.groups[pa].updatePosition(oa);this.updateCallouts();this.logger&&this.logger.endRun('_position');},_getDims:function(){return new w(this._getW(),this._getH());},_getH:function(){return this.map.getHeight();},_getW:function(){return this.map.getWidth();},_onMapClick:function(){this._inform(na.Events.mapClick);},_onViewChangeEnd:function(){this._inform(na.Events.viewChangeEnd,this._getMapView(),l.BEHAVIOR_STATE);},_onViewChange:function(){this.mapReady=true;this._inform(na.Events.viewChange,this._getMapView(),l.BEHAVIOR_STATE);this.topLeft=m.fromLatLong(this.getCenter()).add(this.getZoom(),this._getDims().mul(-.5));if(this.lastZoom!==this.getZoom()){this.lastZoom=this.getZoom();while(this.zoomStack.length&&this.getZoom()<=this.zoomStack[this.zoomStack.length-1].zoom)this.zoomStack.pop();this._setZoomButtonVisibility();this._aggregate();}else if(!this.lastRender||this.topLeft.calculateDistanceX(this.getZoom(),this.lastRender)>ca||this.topLeft.calculateDistanceY(this.getZoom(),this.lastRender)>ca){this._renderOverlay();}else this._position();var oa=p.scry(this.canvas,"span.__0")[0];oa&&o.conditionShow(oa,this._showSnapBack());},_showSnapBack:function(){if(this.zoomStack.length){return true;}else if(this.initialView){var oa=this.initialView;if(this.getZoom()>oa.zoom){return true;}else{var pa=this._getMapView(),qa=la/n.scale(1,this.getZoom());return Math.abs(pa.center.latitude-oa.center.latitude)>qa||Math.abs(pa.center.longitude-oa.center.longitude)>qa;}}return false;},_onMouseDown:function(oa){this.xDown=oa.pageX;this.yDown=oa.pageY;},_onMouseUp:function(oa){if(this.xDown==oa.pageX&&this.yDown==oa.pageY)this._onMapClick();},_onZoomStart:function(oa){for(var pa=0;pa<this.groups.length;pa++)this.groups[pa].dismissMarker();},_onDoubleClick:function(oa){var pa=this.map.tryPixelToLocation(new this.microsoftMaps.Point(oa.getX(),oa.getY()),null);this._zoom(true,1,pa);oa.handled=true;return false;},_onBeforeLeave:function(){for(var oa=0;oa<this.listeners.length;oa++)this.listeners[oa].unsubscribe();this.bingMapEvents.forEach(function(pa){this.microsoftMaps.Events.removeHandler(pa);}.bind(this));}});Object.assign(na,{Anchor:{DEFAULT:'default_anchor'},Events:{calloutHidden:'calloutHidden',ready:'ready',mapClick:'mapClick',viewChange:'viewChange',viewChangeEnd:'viewChangeEnd',bubbleClick:'bubbleClick',bubbleMouseover:'bubbleMouseover',bubbleMouseout:'bubbleMouseout',pinClick:'pinClick',pinMouseover:'pinMouseover',pinMouseout:'pinMouseout',onSearchSubmit:'onSearchSubmit'},Listeners:{hideCallout:'hideCallout',zoomDelta:'zoomDelta',zoomIn:'zoomIn',zoomOut:'zoomOut',zoomBack:'zoomBack',closeCalloutAndZoomBack:'closeCalloutAndZoomBack',onAddPin:'onAddPin'},inform:function(oa,event,pa,qa){if(!pa){pa={};pa._instanceid=oa;}l.inform('AggregatedMap/'+event,pa,qa);},listenThenInform:function(oa,pa,qa,ra){g.listen(pa,qa,function(){na.inform(oa,ra);});},subscribe:function(oa,event,pa){l.subscribe('AggregatedMap/'+event,na._guard(oa,pa));},subscribeAll:function(oa,pa){for(var qa in na.Events){var ra=pa['aggregatedMapHandler_'+qa];if(ra){ra=ra.bind(pa);na.subscribe(oa,qa,ra);}}},_guard:function(oa,pa){return function(qa,ra,sa){if(!sa._instanceid){throw new Error('aggregated map didnt pass instanceid');}else if(sa._instanceid!==oa)return;return qa(sa);}.bind(this,pa);}});e.exports=na;},null);
__d("AggregatedMapCircleSprite",["DOM"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();function h(m,n,o,p){this._size=m;this._radius=n;if(p){this.chooseAggregationRadius=p;this._aggregationRadius=p(this._size);}this._count=o;}function i(){return this._radius;}function j(){return this._radius*2;}function k(m){switch(m){case h.SIZE_SMALL:return 9;case h.SIZE_MEDIUM:return 11;case h.SIZE_LARGE:return 16;}}function l(m){var n;if(this.chooseAggregationRadius){n=this.chooseAggregationRadius;}else n=k;var o=this.getCount()+m.getCount();if(o>=100){return h.large(o,n);}else if(o>=10){return h.medium(o,n);}else return h.small(o,n);}Object.assign(h.prototype,{render:function(){var m=g.create('div',{className:['fbAggregatedMapBubble','fbAggregatedMapBubble'+this._size].join(' ')});g.setContent(m,this._count);var n=g.create('div',{className:['fbAggregatedMapBubbleShell','fbAggregatedMapBubbleShell'+this._size].join(' ')});g.setContent(n,m);this._root=n;return n;},combine:l,getCount:function(){return this._count;},getHeight:j,getWidth:j,getAnchorX:i,getAnchorY:i,getCalloutX:i,getCalloutY:i,getAggregationRadius:function(){return this._aggregationRadius;}});Object.assign(h,{RADIUS_SMALL:15,RADIUS_MEDIUM:20,RADIUS_LARGE:28,SIZE_SMALL:'Small',SIZE_MEDIUM:'Medium',SIZE_LARGE:'Large',small:function(m,n){return new h(h.SIZE_SMALL,h.RADIUS_SMALL,m,n);},medium:function(m,n){return new h(h.SIZE_MEDIUM,h.RADIUS_MEDIUM,m,n);},large:function(m,n){return new h(h.SIZE_LARGE,h.RADIUS_LARGE,m,n);},combine:l});e.exports=h;},null);
__d("AggregatedMapPin",["BingMapCoordinate"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();function h(i,j,k,l,m){this.anchor=g.fromLatLong(i);this.sprite=j;this.name=k||null;this.group=null;this.xhp=l;this.profileID=m;}Object.assign(h.prototype,{getType:function(){return 'AggregatedMapPin';},setZoom:function(i){this.center=this.anchor.getMapXY(i);},getLatitude:function(){return this.anchor.getLatitude();},getLongitude:function(){return this.anchor.getLongitude();},getGroup:function(){return this.group;},getAggregationRadius:function(){return this.sprite.getAggregationRadius();},setSprite:function(i){this.sprite=i;},setCallout:function(i){this._agg_map_callout=i;}});Object.assign(h,{create:function(i,j,k,l){return new h(i,j,k,l);}});e.exports=h;},null);
__d("AggregatedMapRedPinSprite",["AggregatedMapCircleSprite","CSS","DOM"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();function j(k,l,m,n,o,p,q,r,s){this.size=k;this.image=l;this.width=m;this.height=n;this.calloutY=o;this.aggregationRadius=p;this.text=r;this.count=q;this.css=s;}Object.assign(j.prototype,{render:function(){var k=i.create('div');h.addClass(k,'fbAggregatedMapPin');h.addClass(k,'fbAggregatedMapPin'+this.size);if(this.css)h.addClass(k,this.css);var l='/images/places/map/'+this.image,m=i.create('img',{src:l});i.appendContent(k,m);var n=null;if(this.text){n=i.create('div');h.addClass(n,'fbAggregatedMapPinText');h.addClass(n,'fbAggregatedMapPinText'+this.size);i.setContent(n,this.count);i.appendContent(k,n);}return k;},combine:g.combine,getCount:function(){return this.count;},getHeight:function(){return this.height;},getWidth:function(){return this.width;},getAnchorX:function(){return this.width/2;},getAnchorY:function(){return this.height;},getCalloutX:function(){return this.width/2;},getCalloutY:function(){return this.calloutY;},getAggregationRadius:function(){return this.aggregationRadius;}});Object.assign(j,{dot:function(k){if(k===(void 0))k=1;return new j('Small','small_dot.png',17,22,8,10,k,false);},smallBlank:function(k){return new j('Small','small_blank.png',17,22,8,10,k,true);},mediumBlank:function(k){return new j('Medium','medium_blank.png',25,34,12,14,k,true);},largeBlank:function(k){return new j('Large','large_blank.png',29,43,14,17,k,true);}});e.exports=j;},null);
__d("TimelineMapPlace",["arrayContains"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();function h(i){this.stories=[];this.creation=false;this.name=null;i.latitude||(i.latitude=0);i.longitude||(i.longitude=0);Object.assign(this,i);if(this.region)this.region=this.region+':'+this.country;this.visibleStories=this.stories;}Object.assign(h.prototype,{setFilters:function(i){var j=[];for(var k=0;k<this.stories.length;k++)if(!i||g(this.stories[k].categories,i))j.push(this.stories[k]);this.visibleStories=j;},getStories:function(i,j){if(i===(void 0))i=true;var k=i?this.visibleStories:this.stories;if(!j){return k;}else{var l=[];for(var m=0;m<k.length;m++){var n=k[m];if(j(n))l.push(n);}return l;}},count:function(i,j){var k=this.getStories(i,j).length;if(this.creation)k++;return k;}});Object.assign(h,{Filters:{MLE:function(i){return i&&!i.isEnt;},ALL:null}});e.exports=h;},null);
__d("TimelineMapStory",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();function g(h){Object.assign(this,h);}e.exports=g;},null);
__d("TimelineMapController",["AggregatedMap","shield","AggregatedMapCalloutOrientation","AggregatedMapPin","AggregatedMapRedPinSprite","Arbiter","AsyncRequest","BingMapCoordinate","CSS","DOM","MapRects","PageEvents","Rect","Style","TimelineMapPlace","TimelineMapStory","Vector","$","isEmpty","mod","randomShuffle"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa){b.__markCompiled&&b.__markCompiled();var ba=198,ca=132,da=108;function ea(fa,ga,ha,ia,ja,ka,la){this.profileID=null;this.viewasID=null;this.places={};this.visiblePins=null;this.stories={};this.hiddenStories={};this.placesByTime=[];this.category=null;this.pending=null;this.waitingOnConfirmation=false;this.highlightedPin=null;this.arbiterListeners=[];this.calloutBeingFetched=null;this.initialized=false;this._lastResizeCalloutAnchor=null;this._lastResizeCalloutStoryHeight=null;this._lastResizeCalloutStory=null;this._scrollableCalloutController=null;this.inCreation=false;this.lastTypeaheadEvent=null;this.initialPosition=null;this.initialPlace=null;this.initialStory=null;this.hh=0;this.ww=0;this.smartPan=null;this.requestID=0;this.asyncRequests={};this.intervals=[];this.groups=[];this.pagerIndex=null;this.categoryCountUnique={};if(fa)this._init(fa,ga,ha,ia,ja,ka,la);}Object.assign(ea.prototype,{HOVER_FETCH_DELAY:100,HOVER_DISMISS_DELAY:300,MAP_BOTTOM_PADDING:40,MIN_MAP_HEIGHT:532,MIN_CALLOUT_STORY_HEIGHT:200,MAX_CALLOUT_HEIGHT:600,RESIZE_CHECK_INTERVAL:50,HOVERCARD_WIDTH:279,HOVERCARD_HEIGHT:251,HOVERCARD_CLOSED:(void 0),HOVERCARD_WAITING_TO_FETCH:1,HOVERCARD_BEING_FETCHED:2,HOVERCARD_OPEN:3,HOVERCARD_WAITING_TO_DISMISS:4,TIMELINE_MAP_HOVERCARD_PLACE:'Place',TIMELINE_MAP_HOVERCARD_CITY:'City',TIMELINE_MAP_HOVERCARD_REGION:'Region',TIMELINE_MAP_HOVERCARD_COUNTRY:'Country',HOVERCARD_CITY_REGION_HEURISTIC:3,setCategory:function(fa){this.logger&&this.logger.startRun('set-category');this.map.hideCallout();this.category=fa;this._filter();},setCategoryCountUnique:function(fa){this.categoryCountUnique=fa;},getCategories:function(){var fa={},ga,ha;for(var ia in this.places){var ja=this.places[ia],ka={};for(var la=0;la<ja.stories.length;la++){ha=ja.stories[la];if(ha.categories)for(var ma=0;ma<ha.categories.length;ma++){ga=ha.categories[ma];if(!fa[ga])fa[ga]={count:0,name:ga};if(!ka[ga])ka[ga]=1;fa[ga].count++;}}}return fa;},zoomToVisible:function(){this.map.zoomTo(this.visiblePins);},cleanupCreationCallout:function(fa){this.map.hideCallout(fa);this._cleanUpHighlightedPin();},cancelCreation:function(fa){if(!this.inCreation)return;this.inCreation=false;this.cleanupCreationCallout();},creationFinished:function(fa,ga){var ha=ga.place,ia=ga.story,ja=ga.showCallout;this.inCreation=false;this.waitingOnConfirmation=false;this.cleanupCreationCallout();this.addStories(null,{stories:[ia],places:[ha]});if(ja)this.showCallout(null,{place_id:ha.id,story_id:ia.id});},page:function(fa){var ga=this.map.getGroups();if(!ga)return;var ha=[],ia=true,ja=0;for(var ka=0;ka<ga.length;ka++){var la=ga[ka];if(la.hasMarker()){var ma=la.getCenter(),na=new s(0,this.ww,this.hh,0);if(q.containsPoint(na,ma)){ha.push(la);if(la===this.groups[ja]){ja++;}else if(ia)ia=false;}}}ia=ia&&ja===this.groups.length;if(!ia){this.groups=ha;this.sortedGroups=ha.concat([]).sort(function(pa,qa){return pa.getCenter().x-qa.getCenter().x;});if(fa>0){this.pagerIndex=0;}else this.pagerIndex=-1;}else this.pagerIndex+=(fa>0)?1:-1;this.pagerIndex=z(this.pagerIndex,this.sortedGroups.length);var oa=this.sortedGroups[this.pagerIndex];if(oa.pins.length>1){this._openCallout(oa,this.map.throbber(325),this.map.leftRightNoPanningStrategy());oa.hoverPermanent=true;oa.hoverState=this.HOVERCARD_WAITING_TO_FETCH;this._fetchHovercard(oa);}else this.aggregatedMapHandler_pinClick(null,oa.pins[0]);},hovercard:function(fa,ga){var ha=this._getAsyncContext(ga.requestID);if(ha.deleted||ha.hoverState!==this.HOVERCARD_BEING_FETCHED)return;ha.hoverState=this.HOVERCARD_OPEN;var ia=p.create('div');ia.onmouseover=function(){if(!this.map||!this.map.getCallout().getAnchor())return null;this.aggregatedMapHandler_bubbleMouseover(null,this.map.getCallout().getAnchor());}.bind(this);ia.onmouseout=function(){if(!this.map||!this.map.getCallout().getAnchor())return null;this.aggregatedMapHandler_bubbleMouseout(null,this.map.getCallout().getAnchor());}.bind(this);o.setClass(ia,'fbTimelineMapHovercard');p.setContent(ia,ga.content);if(ha===this.map.getCallout().getAnchor()){this.map.getCallout().setContent(ia);}else this._openCallout(ha,ia,this.map.leftRightNoPanningStrategy());this.map.getCallout().recalculateArrowYOffset(true);this.logger&&this.logger.endRun('load-hovercard');},callout:function(fa,ga){var ha=this._getAsyncContext(ga.requestID);if(this.map.getCallout().getAnchor()!==ha)return;this._openCallout(ha,ga.content);this.logger&&this.logger.endRun('load-callout');},addPending:function(fa,ga){var ha=ga.count;this.pending=this.pending||0;this.pending+=ha;this._checkReady();},hideCallout:function(fa,ga){ga=ga||{};ga._instanceid=this.instanceID;l.inform('AggregatedMap/hideCallout',ga);},addStories:function(fa,ga){var ha=ga.stories,ia=ga.places;if(ga.count)this.pending=(this.pending||0)-ga.count;var ja,ka,la,ma;for(ma=0;ma<ia.length;ma++){ka=new u(ia[ma]);if(!this.places[ka.id]){this.places[ka.id]=ka;this.placesByTime.push(ka);}ka.mostRecentTimestamp=0;}for(ma=0;ma<ha.length;ma++){la=new v(ha[ma]);this.stories[la.id]=la;ja=la.placeID;ka=this.places[ja];ka.stories.push(la);ka.mostRecentTimestamp=Math.max(ka.mostRecentTimestamp,la.timestamp);}if(ga.count===(void 0)){this._refresh();}else this._checkReady();},updateStory:function(fa,ga){var ha=ga.place,ia=ga.story,ja=this.stories[ia.id];if(ja.placeID!=ha.id){var ka={};ka[ja.id]=true;this._removeStories(ja.placeID,ka);this.addStories(null,{stories:[ia],places:[ha]});}this._showCallout(this.places[ha.id].pin,ha.id,ia.id);},deleteStory:function(fa,ga){var ha=this.map.getCallout().getAnchor(),ia=this.stories[ga];if(!ia)return;var ja={};ja[ia.id]=true;this.map.hideCallout();var ka=this._removeStories(ia.placeID,ja);ka.stories_removed&&this._refresh();!ka.place_removed&&this._showCallout(ha,ha.place.id);},hideStory:function(fa,ga){var ha=this.map.getCallout().getAnchor(),ia=this.stories[ga.story_id];if(!ha)return;if(ha.getType()!=='AggregatedMapPin')return;if(!ia||ia.placeID!=ha.place.id)return;var ja=x(ga.story_domid);o.hide(ja);var ka=p.insertAfter(ja,ga.undo_html)[0];this.hiddenStories[ia.id]={story_domid:ja.id,undo_domid:ka.id};},undoHideStory:function(fa,ga){var ha=this.stories[ga],ia=this.hiddenStories[ha.id];p.remove(ia.undo_domid);o.show(ia.story_domid);delete this.hiddenStories[ha.id];},showCallout:function(fa,ga){var ha=this.places[ga.place_id].pin;this._showCallout(ha,ga.place_id,ga.story_id);},zoomIntoOne:function(fa,ga){var ha=this.places[ga.place_id];this._zoomToPlace(ha);},zoomToArea:function(fa,ga){var ha=ga.type,ia=ga.key,ja=[];for(var ka in this.places){var la=this.places[ka],ma=la.pin;if((la.city===ia&&ha===this.TIMELINE_MAP_HOVERCARD_CITY)||(la.region===ia&&ha===this.TIMELINE_MAP_HOVERCARD_REGION)||(la.country===ia&&ha===this.TIMELINE_MAP_HOVERCARD_COUNTRY))ja.push(ma);}this.map.zoomInto(ja);},creationFlow:function(fa,ga){var ha=ga.place,ia={latitude:ha.latitude,longitude:ha.longitude};this.waitingOnConfirmation=false;this._highlightPlace(ha.id,ia);this._openCallout(this.highlightedPin,ga.content,this.smartPan);this.inCreation=true;},highlightMapPlace:function(fa,ga){if(ga.dismiss&&this.waitingOnConfirmation)return;if(ga.showThrobber){this._openCallout(this.highlightedPin,this.map.throbber(),this.smartPan);return;}this.map.hideCallout();if(ga.dismiss){this._cleanUpHighlightedPin();}else if(ga.selected){this.waitingOnConfirmation=true;}else if(ga.center)this._highlightPlace(ga.placeID,ga.center);this.map.setView(ga);},registerScrollableCallout:function(fa,ga){this._scrollableCalloutController=ga;},_init:function(fa,ga,ha,ia,ja,ka,la){this.profileID=fa;this.viewasID=ga.viewas;this.mapContainer=ha;this.canvas=p.find(this.mapContainer,'.fbAggregatedMapContainer');this.logger=ja;this.instanceID=ia;this._dynamicSize=ga.dynamicSize;if(ga.center)this.initialPosition={latitude:ga.center.lat,longitude:ga.center.long};this.initialPlace=ga.highlightedPlace;this.initialStory=ga.highlightedStory;this.enableHovercards=ga.enableHovercards;this.calloutDiv=ka&&x(ka);this.maxCalloutHeight=this.MAX_CALLOUT_HEIGHT;if(ga.maxCalloutHeight&&ga.maxCalloutHeight<this.MAX_CALLOUT_HEIGHT)this.maxCalloutHeight=ga.maxCalloutHeight;if(la){la.subscribe('next',this.page.bind(this,1));la.subscribe('previous',this.page.bind(this,-1));}this.border=x('fbTimelineMapBorder');this._subscribe(r.AJAXPIPE_ONUNLOAD,this._onBeforeLeave.bind(this));this._subscribe('AggregatedMap/ready',this._onInit.bind(this));this._subscribe('AggregatedMap/calloutHidden',this.cancelCreation.bind(this));this._subscribe('AggregatedMap/calloutHidden',h(l.inform,null,'reflow'));this._subscribe('TimelineMapStickyHeaderComposer/typeaheadFocus',this._handleTypeahead.bind(this,'focus'));this._subscribe('TimelineMapStickyHeaderComposer/typeaheadBlur',this._handleTypeahead.bind(this,'blur'));this._subscribe('TimelineMapStickyHeaderComposer/typeaheadSelect',this._handleTypeahead.bind(this,'select'));},_onInit:function(fa,ga){this.map=ga;if(this._dynamicSize){this._resizeMap();this.intervals=[setInterval(this._resizeMap.bind(this),this.RESIZE_CHECK_INTERVAL),setInterval(this.resizeCallout.bind(this),this.RESIZE_CHECK_INTERVAL)];}else{this.hh=this.map.getHeight();this.ww=this.map.getWidth();}this.initialized=true;for(var ha in ea.Listeners)this._subscribe('TimelineMap/'+ha,this[ha].bind(this));for(var ia in g.Events){var ja=this['aggregatedMapHandler_'+ia];if(ja){ja=ja.bind(this);this._subscribe('AggregatedMap/'+ia,ja);}}this.smartPan=this.map.smartPanningStrategy();},_getAsyncContext:function(fa){var ga=this.asyncRequests[fa];delete this.asyncRequests[fa];return ga;},_storeAsyncContext:function(fa){var ga=this.requestID++;this.asyncRequests[ga]=fa;return ga;},_inform:function(fa,ga,ha){ga=ga||{};ga._instanceid=this.instanceID;ea.inform('TimelineMap/'+fa,ga,ha);},_cleanUpHighlightedPin:function(){if(this.highlightedPin){if(this.highlightedPin.isPreview){this.map.removePin(this.highlightedPin);}else{this.highlightedPin.setSprite(this._getPlaceSprite(this.highlightedPin.place));this.map.redraw();}this.highlightedPin=null;o.removeClass(this.canvas,'fbTimelineMapDimPinMode');}},_handleTypeahead:function(fa){!this.inCreation&&fa=='blur'&&this.lastTypeaheadEvent=='focus';this.lastTypeaheadEvent=fa;},_checkReady:function(){if(this.pending!==0)return;this._refresh();if(this.logger){window._cstart&&this.logger.set('flushTTI',Date.now()-window._cstart);for(var fa in this.places){var ga=this.places[fa];this.logger.bump('places');this.logger.bump('stories',ga.count());}this.logger.set('profileID',this.profileID);}if(window.CavalryLogger)window.CavalryLogger.getInstance().measurePageLoad(true);var ha=this.initialPlace,ia=this.initialStory;if(ha){this.map.zoomTo(this.visiblePins,false);this.map.setInitialView();var ja=this.places[ha].pin;if(ja){var ka=new w(ba,ca);ka=ka.sub(new w(this.ww/2,this.hh/2));this.map.zoomIntoOne(ja,ka);var la=p.find(this.calloutDiv,'.fbTimelineMapCallout');p.remove(this.calloutDiv);this._openCallout(ja,la);this.map.getCallout().setArrowYOffset(da);this.map.updateCallouts();}}else if(this.initialPosition){this.map.setView({center:this.initialPosition});}else{this.map.zoomTo(this.visiblePins,false);this.map.setInitialView();}o.addClass(this.border,'fbTimelineMapContainerLoaded');},_refresh:function(){this.placesByTime=this.placesByTime.sort(function(fa,ga){return fa.mostRecentTimestamp-ga.mostRecentTimestamp;});this._filter();this._inform(ea.Events.updateCategories,null,l.BEHAVIOR_STATE);},_resizeMap:function(){var fa=w.getViewportDimensions().y,ga=w.getElementPosition(this.border).y,ha=w.getElementDimensions(this.border).y,ia=fa-(ga+ha),ja=this.hh+ia-this.MAP_BOTTOM_PADDING;ja=Math.max(this.MIN_MAP_HEIGHT,Math.min(ja,fa));if(Math.abs(this.hh-ja)>1){t.set(this.mapContainer,'height',ja+'px');this.map.invalidateSize();this.hh=ja;this.ww=this.map.ww;this._resizeMap();}},resizeCallout:function(){var fa=this.map.getCallout().getContent(),ga=p.scry(fa,'.fbTimelineMapScrollableStory');for(var ha=ga.length-1;ha>=0;ha--)if(!o.hasClass(ga[ha],'hidden_elem')){var ia=ga[ha],ja=p.find(ia,'.fbTimelineMapCalloutStory');break;}if(!(fa&&ja&&ia))return;var ka=w.getElementDimensions(ja).y;if(this.map.getCallout().getAnchor()===this._lastResizeCalloutAnchor&&ka===this._lastResizeCalloutStoryHeight&&ja===this._lastResizeCalloutStory)return;var la=p.find(fa,'.fbTimelineMapCalloutHeader'),ma=w.getElementDimensions(la).y,na=w.getElementPosition(ia).y,oa=w.getElementPosition(this.mapContainer).y,pa=this.hh-this.map.CALLOUT_MARGIN,qa=Math.max(this.MIN_CALLOUT_STORY_HEIGHT,Math.min((oa+pa)-na,pa-ma)),ra=Math.min(ka,qa,this.maxCalloutHeight);t.set(ia,'height',ra+'px');this._lastResizeCalloutAnchor=this.map.getCallout().getAnchor();this._lastResizeCalloutStoryHeight=ka;this._lastResizeCalloutStory=ja;if(this._scrollableCalloutController)this._scrollableCalloutController.adjustGripper();this.map.getCallout()._updateDimensions();this.map.getCallout().recalculateArrowYOffset();},_filter:function(){var fa=[];for(var ga in this.places){var ha=this.places[ga];ha.setFilters(this.category);if(ha.count()>0){var ia=this._getPlaceSprite(ha),ja=j.create(ha,ia,ha.name);ha.pin=ja;ja.place=ha;fa.push(ja);}}this.visiblePins=fa;if(this.highlightedPin)this.visiblePins.push(this.highlightedPin);this.map.setPins(fa);},_getPlaceSprite:function(fa){var ga=fa.getStories(),ha=ga.length,ia;if(ha>=100){ia=k.largeBlank(ha);}else if(ha>10){ia=k.mediumBlank(ha);}else if(ha>1){ia=k.smallBlank(ha);}else if(ga[0]&&ga[0].pin){ia=k.mediumBlank(1);ia.text=false;ia.image=ga[0].pin+'.png';}else ia=k.dot();return ia;},_getHighlightedSprite:function(){var fa=k.dot();fa.aggregationRadius=0;fa.css='fbTimelineMapHighlighted';return fa;},_highlightPlace:function(fa,ga){this._cleanUpHighlightedPin();var ha;if(fa&&this.places[fa]!==(void 0)){ha=this.places[fa].pin;ha.setSprite(this._getHighlightedSprite());this.map.redraw();}else{ha=new j(n.fromLatLong(ga),this._getHighlightedSprite());ha.isPreview=true;this.map.addPin(ha);}this.highlightedPin=ha;o.addClass(this.canvas,'fbTimelineMapDimPinMode');return ha;},_showCallout:function(fa,ga,ha){if(this.map.getCallout()&&this.map.getCallout().getOrientation()){var ia=this.map.getCallout().getOrientation()===i.LEFT,ja=new w(ia?200:-200,-100);this.map.zoomIntoOne(fa,ja);}this._openCallout(fa,this.map.throbber(),this.smartPan);this._fetchCallout(fa,ga,ha);},_fetchCallout:function(fa,ga,ha){this.logger&&this.logger.startRun('load-callout');var ia=this._storeAsyncContext(fa),ja=this.places[ga],ka=[],la={},ma=ja.getStories();for(var na=0;na<ma.length;++na){var oa=ma[na];if(!oa.isEnt){ka.push(oa.unitParams);}else{la[oa.storyType]=la[oa.storyType]||[];la[oa.storyType].push(oa.id);}}var pa={profile_id:this.profileID,targetid:ja.id,storyid:ha,unitparams:ka,storiesbytype:la,request_id:ia};if(this.viewasID&&this.viewasID!="0")pa.viewas=this.viewasID;new m().setURI('/ajax/timeline/map/callout.php').setMethod('POST').setData(pa).send();},_openCallout:function(fa,ga,ha){var ia=this.map.getCallout().getAnchor();ia&&this._dismissHovercard(ia);this.map.openCallout(fa,ga,ha);this.resizeCallout();},_zoomToPlace:function(fa){var ga=i.LEFT,ha=i.RIGHT,ia=this.map.getCallout().getOrientation()===ga,ja=new w(ia?200:-200,-100);this.map.zoomIntoOne(fa.pin,ja);this._openCallout(fa.pin,this.map.throbber(),this.map.noPanningStrategy(ia?ga:ha));this._fetchCallout(fa.pin,fa.id);},_fetchHovercard:function(fa){this.logger&&this.logger.startRun('load-hovercard');if(fa.deleted||fa.hoverState!==this.HOVERCARD_WAITING_TO_FETCH)return;if(fa.pins.length<2)throw 'bubble has < 2 pins!';delete fa.timeoutToken;fa.hoverState=this.HOVERCARD_BEING_FETCHED;var ga=[],ha=[],ia={},ja={},ka={},la={},ma={},na={};fa.pins.forEach(function(kb){var lb=kb.place,mb=lb.getStories();na[lb.id]=true;for(var nb=0;nb<mb.length;nb++)ga.push(mb[nb]);ha.push(lb);if(lb.city){ia[lb.city]=ia[lb.city]||0;ia[lb.city]++;if(lb.region)ma[lb.region]=lb.city;if(lb.country)la[lb.country]=lb.city;}if(lb.region){ja[lb.region]=ja[lb.region]||0;ja[lb.region]++;}if(lb.country){ka[lb.country]=ka[lb.country]||0;ka[lb.country]++;}});var oa=ha.length,pa=this._storeAsyncContext(fa),qa=this._getStoriesByType(ga).TimelineMapStoryPhoto||[],ra=qa.length,sa=aa(qa).slice(0,4),ta={},ua=ha.length<=3,va=ha.sort(function(kb,lb){return lb.getStories().length-kb.getStories().length;}).slice(0,3).map(function(kb){var lb=0,mb={},nb=kb.getStories();for(var ob=0;ob<nb.length;ob++){var pb=nb[ob],qb=pb.visitID;if(qb===0){lb++;}else if(!(qb in mb)){mb[qb]=true;lb++;}}ta[kb.id]=lb;return kb.id;}),wa=false,xa=false,ya=false;for(var za in this.places){var ab=this.places[za];if(!na[ab.id]&&(ya=ya||ka[ab.country])&&(xa=xa||ja[ab.region])&&(wa=wa||ia[ab.city]))break;}var bb=null,cb=null,db=null,eb=null,fb=null,gb=function(kb,lb,mb){return kb[mb]-kb[lb];};ia=Object.keys(ia).sort(gb.bind(null,ia));ja=Object.keys(ja).sort(gb.bind(null,ja));ka=Object.keys(ka).sort(gb.bind(null,ka));var hb={};hb[this.TIMELINE_MAP_HOVERCARD_COUNTRY]=ka.map(function(kb){return la[kb];});hb[this.TIMELINE_MAP_HOVERCARD_REGION]=ja.map(function(kb){return ma[kb];});hb[this.TIMELINE_MAP_HOVERCARD_CITY]=ia;hb[this.TIMELINE_MAP_HOVERCARD_PLACE]=ha.map(function(kb){return kb.id;});if(ka.length>0)if(!ya){cb=this.TIMELINE_MAP_HOVERCARD_COUNTRY;if(ka.length>1){eb=this.TIMELINE_MAP_HOVERCARD_COUNTRY;}else if(ja.length>1){eb=this.TIMELINE_MAP_HOVERCARD_REGION;}else eb=this.TIMELINE_MAP_HOVERCARD_CITY;}if(ja.length>0&&!cb){var ib=this.HOVERCARD_CITY_REGION_HEURISTIC;if(!xa||ja.length>1&&ia.length>ja.length*ib){cb=this.TIMELINE_MAP_HOVERCARD_REGION;if(ja.length>1){eb=this.TIMELINE_MAP_HOVERCARD_REGION;}else eb=this.TIMELINE_MAP_HOVERCARD_CITY;}}if(ia.length>0&&!cb)if(!wa||ia.length>1){cb=this.TIMELINE_MAP_HOVERCARD_CITY;if(ia.length>1){eb=this.TIMELINE_MAP_HOVERCARD_CITY;}else fb=ha.length;}if(!cb){cb=this.TIMELINE_MAP_HOVERCARD_PLACE;fb=-1;}bb=hb[cb];if(eb)db=hb[eb];var jb={profile_id:this.profileID,request_id:pa,target_count:oa,photo_count:ra,photo_ids:sa,place_counts:ta,target_ids:va,all_places:ua,ids:bb,title_type:cb,subtitle_count:fb,links:db,link_type:eb};if(this.viewasID&&this.viewasID!="0")jb.viewas=this.viewasID;new m().setURI('/ajax/timeline/map/hovercard.php').setMethod('POST').setData(jb).send();},_dismissHovercard:function(fa){delete fa.timeoutToken;delete fa.hoverState;delete fa.hoverPermanent;if(this.map.getCallout().getAnchor()===fa)this.map.hideCallout();},_getStoriesByType:function(fa){var ga={};fa.forEach(function(ha){ga[ha.storyType]=ga[ha.storyType]||[];ga[ha.storyType].push(ha.isEnt?ha.id:ha.unitParams);});return ga;},_removeStories:function(fa,ga){var ha=0,ia=false,ja=this.places[fa],ka=[],la;for(la=0;la<ja.stories.length;++la){var ma=ja.stories[la];if(ga[ma.id]){delete this.stories[ma.id];++ha;}else ka.push(ma);}if(ka.length===0){delete this.places[fa];ia=true;}else ja.stories=ka;return {place_removed:ia,stories_removed:ha};},_removeHiddenStories:function(){var fa=this.map.getCallout().getAnchor();if(!fa)return;if(fa.getType()!=='AggregatedMapPin')return;if(y(this.hiddenStories))return;var ga=fa.place.id,ha=this._removeStories(ga,this.hiddenStories);if(ha.stories_removed!==0){this._refresh();this.hiddenStories={};}},_guard:function(fa){return function(ga,ha){if(!ha||!ha._instanceid||ha._instanceid===this.instanceID)fa(ga,ha);}.bind(this);},_subscribe:function(fa,ga){this.arbiterListeners.push(l.subscribe(fa,this._guard(ga)));},aggregatedMapHandler_mapClick:function(){this._removeHiddenStories();this.map.hideCallout();this._inform(ea.Events.mapClick);},aggregatedMapHandler_pinClick:function(fa,ga){this.logger&&this.logger.bumpTap('pin-click');this._removeHiddenStories();if(this.map.getCallout().getAnchor()===ga){this.map.hideCallout();}else this._showCallout(ga,ga.place.id);},aggregatedMapHandler_bubbleClick:function(fa,ga){this.logger&&this.logger.bumpTap('bubble-click');this.map.hideCallout();this.map.zoomInto(ga.pins);},aggregatedMapHandler_bubbleMouseover:function(fa,ga){if(!this.enableHovercards||ga.hoverPermanent)return;if(!ga.hoverState||ga.hoverState===this.HOVERCARD_CLOSED){ga.hoverState=this.HOVERCARD_WAITING_TO_FETCH;ga.timeoutToken=setTimeout(this._fetchHovercard.bind(this,ga),this.HOVER_FETCH_DELAY);}else if(ga.hoverState===this.HOVERCARD_WAITING_TO_DISMISS){clearTimeout(ga.timeoutToken);delete ga.timeoutToken;ga.hoverState=this.HOVERCARD_OPEN;}},aggregatedMapHandler_bubbleMouseout:function(fa,ga){if(ga.hoverPermanent)return;if(ga.hoverState===this.HOVERCARD_WAITING_TO_FETCH||ga.hoverState===this.HOVERCARD_BEING_FETCHED){clearTimeout(ga.timeoutToken);delete ga.timeoutToken;delete ga.hoverState;}else if(ga.hoverState===this.HOVERCARD_OPEN){ga.timeoutToken=setTimeout(this._dismissHovercard.bind(this,ga),this.HOVER_DISMISS_DELAY);ga.hoverState=this.HOVERCARD_WAITING_TO_DISMISS;}},_onBeforeLeave:function(){for(var fa=0;fa<this.arbiterListeners.length;fa++)this.arbiterListeners[fa].unsubscribe();for(var ga=0;ga<this.intervals.length;ga++)clearInterval(this.intervals[ga]);this.logger=null;this.map=null;this.places=null;}});Object.assign(ea,{Events:{updateCategories:'updateCategories',mapClick:'mapClick'},Listeners:{addStories:'addStories',updateStory:'updateStory',deleteStory:'deleteStory',hideStory:'hideStory',undoHideStory:'undoHideStory',addPending:'addPending',creationFlow:'creationFlow',cleanupCreationCallout:'cleanupCreationCallout',cancelCreation:'cancelCreation',creationFinished:'creationFinished',showCallout:'showCallout',callout:'callout',resizeCallout:'resizeCallout',hovercard:'hovercard',highlightMapPlace:'highlightMapPlace',registerScrollableCallout:'registerScrollableCallout',zoomToVisible:'zoomToVisible',hideCallout:'hideCallout',zoomIntoOne:'zoomIntoOne',zoomToArea:'zoomToArea'},inform:function(fa,ga,ha){if(!ga||!ga._instanceid)return;return l.inform(fa,ga,ha||l.BEHAVIOR_PERSISTENT);}});e.exports=ea;},null);
__d("TimelinePlacesSubCollection",["Arbiter","CSS","Event","TimelineMapController","cx","tidyEvent"],function(a,b,c,d,e,f,g,h,i,j,k,l){b.__markCompiled&&b.__markCompiled();var m="_3s-";function n(o){"use strict";this.$TimelinePlacesSubCollection0=o.id;this.$TimelinePlacesSubCollection1=o.parent_collection;this.$TimelinePlacesSubCollection2=o.sub_tab;this.$TimelinePlacesSubCollection3=o.entity_id;this.$TimelinePlacesSubCollection4=o.collection_token;this.$TimelinePlacesSubCollection5=o.profile_id;this.$TimelinePlacesSubCollection6=o.places_filter;this.$TimelinePlacesSubCollection7=o.city_id;this.$TimelinePlacesSubCollection8=null;this.$TimelinePlacesSubCollection9=0;this.$TimelinePlacesSubCollectiona=0;}n.prototype.hide=function(){"use strict";this.$TimelinePlacesSubCollection2&&h.hasClass(this.$TimelinePlacesSubCollection2,m)&&h.removeClass(this.$TimelinePlacesSubCollection2,m);var o=this.$TimelinePlacesSubCollection1.getMapInstanceID();if(o!=null)g.inform('TimelineMap/hideCallout',{_instanceid:o},g.BEHAVIOR_PERSISTENT);};n.prototype.show=function(){"use strict";!h.hasClass(this.$TimelinePlacesSubCollection2,m)&&h.addClass(this.$TimelinePlacesSubCollection2,m);this.$TimelinePlacesSubCollectionb();g.subscribe('AggregatedMap/ready',this.$TimelinePlacesSubCollectionc(this.$TimelinePlacesSubCollectionb.bind(this)));};n.prototype.getSubTabNode=function(){"use strict";return this.$TimelinePlacesSubCollection2;};n.prototype.getParentCollection=function(){"use strict";return this.$TimelinePlacesSubCollection1;};n.prototype.getEntityID=function(){"use strict";return this.$TimelinePlacesSubCollection3;};n.prototype.$TimelinePlacesSubCollectionb=function(){"use strict";var o=this.$TimelinePlacesSubCollection1.getMapInstanceID();if(o==null)return;g.inform('TimelineMap/zoomToArea',{_instanceid:o,type:j.prototype.TIMELINE_MAP_HOVERCARD_CITY,key:this.$TimelinePlacesSubCollection7},g.BEHAVIOR_PERSISTENT);};n.prototype.$TimelinePlacesSubCollectionc=function(o){"use strict";return function(p,q){if(!q||!q.$TimelinePlacesSubCollectiond||q.$TimelinePlacesSubCollectiond===this.$TimelinePlacesSubCollection1.getMapInstanceID())o(p,q);}.bind(this);};n.prototype.$TimelinePlacesSubCollectione=function(){"use strict";if(this.getParentCollection().getActiveSubCollection()===this)return true;return false;};n.build=function(o,p,q,r,s,t,u){"use strict";if(o!=null&&p&&q&&q.sub_tab&&q.entity_id!=null&&r&&s!=null&&t!=null&&u!=null){var v={id:o,parent_collection:p,sub_tab:q.sub_tab,entity_id:q.entity_id,collection_token:r,profile_id:s,places_filter:t,city_id:u},w=new n(v);l(i.listen(w.getSubTabNode(),'click',function(x){w.getParentCollection().setActiveSubCollection(w);}));return w;}return null;};e.exports=n;},null);
__d("TimelinePlacesCollection",["CSS","DOM","DOMDimensions","DOMQuery","MenuItem","TimelineAppCollection","TimelinePlacesSubCollection","ProfileOverviewSection","csx","cx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){b.__markCompiled&&b.__markCompiled();var q=820;for(var r in l)if(l.hasOwnProperty(r))t[r]=l[r];var s=l===null?null:l.prototype;t.prototype=Object.create(s);t.prototype.constructor=t;t.__superConstructor__=l;function t(u){"use strict";l.call(this,u);this.$TimelinePlacesCollection0=u.token;this.$TimelinePlacesCollection1=null;this.$TimelinePlacesCollection2=null;this.$TimelinePlacesCollection3=[];this.$TimelinePlacesCollection4=null;this.$TimelinePlacesCollection5=null;}t.prototype.show=function(){"use strict";this.$TimelinePlacesCollection1&&g.show(this.$TimelinePlacesCollection1);};t.prototype.hide=function(){"use strict";this.$TimelinePlacesCollection1&&g.hide(this.$TimelinePlacesCollection1);};t.prototype.setActiveSubCollection=function(u){"use strict";this.$TimelinePlacesCollection2&&this.$TimelinePlacesCollection2.hide();this.$TimelinePlacesCollection2=u;this.$TimelinePlacesCollection2&&this.$TimelinePlacesCollection2.show();};t.prototype.getSubCollectionWithID=function(u){"use strict";if(0<=u&&this.$TimelinePlacesCollection3&&u<this.$TimelinePlacesCollection3.length)return this.$TimelinePlacesCollection3[u];return null;};t.prototype.getMapInstanceID=function(){"use strict";return this.$TimelinePlacesCollection5;};t.prototype.getActiveSubCollection=function(){"use strict";return this.$TimelinePlacesCollection2;};t.prototype.$TimelinePlacesCollection6=function(u){"use strict";if(!u)throw new Error("Don't provide enough information to register sub-collections.");this.$TimelinePlacesCollection7(u);};t.prototype.$TimelinePlacesCollection8=function(u){"use strict";if(!u.sub_collections_filter)throw Error("No sub-collection filter is specified.");if(u.map_instance_id==null)throw Error('No instance id of the map is specified.');this.$TimelinePlacesCollection5=u.map_instance_id;this.$TimelinePlacesCollection7({filter:u.sub_collections_filter});};t.prototype.$TimelinePlacesCollection7=function(u){"use strict";this.$TimelinePlacesCollection4=Object.assign({},this.$TimelinePlacesCollection4,u);var v=this.$TimelinePlacesCollection4;if(!v.sub_collections||!v.sub_collections.length||!v.filter||!this.$TimelinePlacesCollection0||v.profile_id==null||!v.more_popover_menu||!v.more_menu)return;for(var w=0;w<v.sub_collections.length;w++){var x=null,y=v.sub_collections[w].city_id;if(y&&v.filter[y])x=m.build(this.$TimelinePlacesCollection3.length,this,v.sub_collections[w],this.$TimelinePlacesCollection0,v.profile_id,v.filter[y],y);if(x)this.$TimelinePlacesCollection3.push(x);}if(this.$TimelinePlacesCollection3.length){this.$TimelinePlacesCollection9(this.$TimelinePlacesCollection3,v.more_popover_menu,v.more_menu);setTimeout(function(){this.setActiveSubCollection(this.$TimelinePlacesCollection3[0]);}.bind(this),2000);}};t.prototype.$TimelinePlacesCollection9=function(u,v,w){"use strict";var x=j.find(this.getParentSection().getNode(),"._33hy");if(!x)return;var y=h.create('div',{className:"_33hy"});h.replace(x,y);this.$TimelinePlacesCollection1=y;this.$TimelinePlacesCollectiona(y,u,v,w);};t.prototype.$TimelinePlacesCollectiona=function(u,v,w,x){"use strict";var y=0;for(var z=0;z<v.length;z++)if(v[z].getSubTabNode()){h.appendContent(u,v[z].getSubTabNode());y+=i.getElementDimensions(v[z].getSubTabNode()).width;}h.appendContent(u,w);y+=i.getElementDimensions(w).width;if(y<=q){g.hide(w);}else{var aa=v.length-1;while(y>q){if(aa<0)return;y-=i.getElementDimensions(v[aa].getSubTabNode()).width;h.remove(v[aa].getSubTabNode());var ba=new k({markup:v[aa].getSubTabNode()});if(x.getItemAt(0)){x.addItemBefore(ba,x.getItemAt(0));}else x.addItem(ba);aa--;}}};t.registerSubCollections=function(u){"use strict";this.checkCollectionID(u.collection_id);n.callWithSection(u.collection_id,function(v){if(v)v.$TimelinePlacesCollection6(u);});};t.registerSubCollectionsFilter=function(u){"use strict";this.checkCollectionID(u.collection_id);n.callWithSection(u.collection_id,function(v){if(v)v.$TimelinePlacesCollection8(u);});};t.checkCollectionID=function(u){"use strict";if(u==null)throw new Error("No collection id is specified when trying to access"+" a static function in TimelinePlacesCollection.");};e.exports=t;},null);
__d("TimelineAppCollectionFactory",["TimelineAppCollection","TimelinePlacesCollection"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i='map';function j(){"use strict";}j.createFromArray=function(k,l){"use strict";return l.map(function(m){if(k===i)return new h(m);return new g(m);});};e.exports=j;},null);
__d("TimelineMonitor",["Arbiter","Event","Run","Vector","ViewportBounds","ge","queryThenMutateDOM"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){b.__markCompiled&&b.__markCompiled();var n={},o={},p=0,q=[],r=null,s=false;function t(){n={};o={};p=0;q.length=0;r&&r.remove();r=null;s=false;}function u(){if(!r)r=h.listen(window,'scroll',z);if(!s){i.onLeave(t);s=true;}z();}var v=[],w=[];function x(){q.forEach(function(ea){var fa=aa.getSection(ea);if(fa&&fa!==o[ea.id]){o[ea.id]=fa;v.push({section:fa});}});var ba=k.getTop()+j.getScrollPosition().y;for(var ca in n){var da=n[ca];if((ba>=da.boundary&&p<=da.boundary)||(ba<=da.boundary&&p>=da.boundary)){n[ca].fromAbove=p<ba;w.push(n[ca]);}}p=ba;}function y(){v.forEach(function(ba){g.inform(aa.SECTION_CHANGE,ba);});w.forEach(function(ba){g.inform(aa.BOUNDARY_PASSED,ba);});v.length=0;w.length=0;}function z(){m(x,y,'TimelineMonitor/scroll');}var aa={BOUNDARY_PASSED:'TimelineMonitor/boundary',SECTION_CHANGE:'TimelineMonitor/change',getSection:function(ba){var ca=k.getTop()+j.getScrollPosition().y,da=ba.childSections.getHead();while(da){if(l(da.nodeID)&&ca<j.getElementPosition(da.getNode()).y+j.getElementDimensions(da.getNode()).y)return da;da=da.getNext();}},monitorBoundary:function(ba,ca){ca=ca||ba;if(!n[ca]||n[ca].boundary!==ba){n[ca]={boundary:ba,id:ca};u();}},monitorSection:function(ba){o[ba.id]=null;q.push(ba);u();return aa.getSection(ba);},poke:function(ba){z();}};e.exports=aa;},null);
__d("TimelineAppSection",["AppSectionCurationState","Arbiter","CSS","DOM","DOMQuery","DOMScroll","JSLogger","ProfileOverviewDOMID","MedleyPageletRequestData","PageletSet","Style","TidyArbiter","TidyArbiterMixin","TimelineAppCollectionFactory","TimelineAppSectionCuration","TimelineDynamicSection","TimelineMonitor","ProfileOverviewSection","TimelineSmartInsert","TriggerablePageletLoader","ViewportBounds","csx","cx","ge","fbt","mixin","classWithMixins"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga){b.__markCompiled&&b.__markCompiled();var ha=500,ia=2,ja=500,ka=18,la="_5bry",ma="_3s-",na=j.create('div',{className:"_3s_"});function oa(){return j.create('span',{className:"_3s18"},[j.create('a',{className:"_3s19",href:'#'},ea._("More")),j.create('span',{className:"_3s1a"})]);}var pa=m.create('collections'),qa={notes:295,events:345,photos:555,app_quoraapp:569,fitness:619,friends:603,app_foodspotting:621,map:621,favorites:645,app_pinterestapp:699,app_instapp:699,books:699,movies:699,tv:699,music:725};function ra(wa){return qa[wa.replace(n.PREFIX_MEDLEY,'')];}var sa=ga(v,fa(s));for(var ta in sa)if(sa.hasOwnProperty(ta))va[ta]=sa[ta];var ua=sa===null?null:sa.prototype;va.prototype=Object.create(ua);va.prototype.constructor=va;va.__superConstructor__=sa;function va(wa,xa,ya,za){"use strict";sa.call(this,va.getIDBySK(xa),wa,ya);this._sk=xa;this._title=za;}va.prototype._createNode=function(){"use strict";var wa=ua._createNode.call(this);wa.setAttribute('aria-labelledby',n.PREFIX_MEDLEY_HEADER+this._sk);wa.setAttribute('aria-role','region');j.prependContent(wa,j.create('div',{className:"_3cz"},[this._title,j.create('div',{className:"_3dc",'aria-role':'tablist'})]));this.resetMinHeight(wa);return wa;};va.prototype.addAuxContent=function(wa){"use strict";var xa=k.scry(this.getNode(),"._6ph")[0];xa&&j.appendContent(xa,wa);this._activeCollection&&this._checkTabDimensions(this._activeCollection);};va.prototype.nullStateCurationContent=function(){"use strict";if(!this._nullStateContent)return;var wa=k.find(this.getNode(),"._1_cb");j.replace(wa.firstChild,this._nullStateContent);};va.prototype.addCurationContent=function(wa,xa,ya,za){"use strict";za=za?za:0;var ab=k.scry(this.getNode(),"._1_cb"),bb=za<ab.length?ab[za]:null;bb&&j.appendContent(bb,wa);if(ya)this._nullStateContent=ya;this.checkCurationContent(xa);};va.prototype.createTriggerLoader=function(wa){"use strict";var xa=function(ya){this._parentSection._lastLoadedSection=this;this.setIsLoaded(true);y.enable();y.run(this.getNode(),function(){ya();this.unsetMinHeight();w.poke(this._parentSection.id);}.bind(this),'viewport');}.bind(this);r.subscribe('Medley/requestDataSet',function(){this._triggerLoader=new z({controller:this._controller,data:this.getData(),displayCallback:xa,options:{constHeight:true},node:this.getNode()},[{node:this.getNode(),onVisibleBuffer:ha,onVisibleStrict:true,type:wa?z.TRIGGER_NOW:z.TRIGGER_ONVISIBLE}]);}.bind(this));};va.prototype.freeze=function(){"use strict";i.addClass(this.getNode(),"_c4e");if(da(this.nodeID)&&!this.isLoaded())this._triggerLoader&&this._triggerLoader.disableTriggers();this.freezeChildren();};va.prototype.getData=function(){"use strict";if(!this._data)this._data=Object.assign({sk:this._sk},o.get(),{overview:!this.isActiveAppSection()});return this._data;};va.prototype.isActiveAppSection=function(){"use strict";return this._parentSection._sk===this._sk;};va.prototype.getActiveCollection=function(){"use strict";return this._activeCollection;};va.prototype.remove=function(){"use strict";if(p.hasPagelet(this.id))p.removePagelet(this.id);j.remove(this.getNode());this._parentSection.removeChildSection(this.id);};va.prototype.setActiveCollection=function(wa){"use strict";if(this._activeCollection===wa||!wa._tabNode)return;if(this._activeCollection){h.inform('TimelineSideAds/refresh');pa.log('change_collection',{previous_collection:this._activeCollection.getToken(),new_collection:wa.getToken()});this.hideCollection(this._activeCollection);var xa=j.scry(this._activeCollection._tabNode,"div._3s_"),ya=na;if(xa.length>0)ya=xa[0];j.appendContent(wa._tabNode,ya.cloneNode(true));xa.forEach(j.remove);}this._activeCollection=wa;this.showCollection(this._activeCollection);};va.prototype.hideCollection=function(wa){"use strict";if(wa){if(wa.getRootClass())i.removeClass(this.getNode(),wa.getRootClass());this.resetMinHeight();wa.disableContentLoader();i.hide(wa.getNode());i.removeClass(wa._tabNode,ma);wa.auxContent&&i.hide(wa.auxContent);wa.curationContent&&i.hide(wa.curationContent);wa._tabNode.setAttribute('aria-selected','false');}};va.prototype.showCollection=function(wa){"use strict";if(wa.getRootClass())i.addClass(this.getNode(),wa.getRootClass());wa.auxContent&&i.show(wa.auxContent);this.checkCurationContent(wa);i.addClass(wa._tabNode,ma);this._checkTabDimensions(wa);va.inform('changeCollection');if(!da(wa.nodeID))j.appendContent(k.find(this.getNode(),"div._3i9"),wa.getNode());i.show(wa.getNode());wa.isLoaded()&&this.unsetMinHeight();wa._tabNode.setAttribute('aria-selected','true');wa.enableContentLoader();var xa=va.getIDBySK(this._sk),ya=u.getSectionState(xa);if(ya)u.refreshState(ya,xa);};va.prototype.resetMinHeight=function(wa){"use strict";wa||(wa=this.getNode());var xa=ra(this.id)||wa.offsetHeight-ia;xa>0&&this._updateScrollAfterHeight(wa,xa);};va.prototype.scrollTo=function(wa,xa){"use strict";var ya=aa.getElementPosition(this.getNode());ya.y-=wa||ka;xa&&this._parentSection.toggleScrollLoad(false);l.scrollTo(ya,ja,null,null,0,function(){ya=aa.getElementPosition(this.getNode());ya.y-=wa||ka;l.scrollTo(ya);xa&&this._parentSection.toggleScrollLoad(true);}.bind(this));};va.prototype.thaw=function(){"use strict";i.removeClass(this.getNode(),"_c4e");this._triggerLoader&&this._triggerLoader.enableTriggers();this.thawChildren();};va.prototype.unsetMinHeight=function(){"use strict";this._updateScrollAfterHeight(this.getNode(),0);};va.prototype._updateScrollAfterHeight=function(wa,xa){"use strict";q.set(wa,'min-height',xa+'px');h.inform('reflow');};va.prototype.checkCurationContent=function(wa){"use strict";var xa=k.scry(this.getNode(),"._2zh3")[0];if(xa){i.conditionShow(xa,wa.curationContent);if(wa.curationContent){i.show(wa.curationContent);if(wa.curationContentState&&wa===this._activeCollection)u.informState(wa.curationContentState,this.id,wa.getToken(),wa.curationContentState!=g.hide);}else u.informState(g.hide,this.id,wa.getToken(),true);}};va.prototype._getTabObj=function(){"use strict";if(!this._tabObj){this._tabObj={aux:j.find(this.getNode(),"._6ph"),items:[],nav:j.find(this.getNode(),"._1_ca"),tabs:j.find(this.getNode(),"._3dc"),width:0};i.addClass(this._tabObj.tabs,"_5brz");}return this._tabObj;};va.prototype._checkTabDimensions=function(wa){"use strict";var xa=this._getTabObj(),ya=xa.nav.offsetWidth-xa.aux.offsetWidth;if(ya>=xa.width){if(!xa.hidden&&ya-xa.tabs.offsetWidth>=0)return;i.removeClass(xa.tabs,la);}if(xa.hidden&&wa._tabNode.parentNode===xa.overflow){j.prependContent(xa.overflow,xa.dropdown.previousSibling);j.insertBefore(xa.dropdown,wa._tabNode);}if(ya-xa.tabs.offsetWidth>=0&&!xa.hidden)return;var za=xa.items.length;if(za&&xa.hidden){for(var ab=0;ab<za;ab++)j.appendContent(xa.tabs,xa.items[ab]);j.remove(xa.dropdown);}i.conditionClass(xa.tabs,la,ya-xa.tabs.offsetWidth<0);xa.width=ya;xa.hidden=0;if(ya-xa.tabs.offsetWidth>=0)return;if(!xa.dropdown){xa.dropdown=oa();xa.overflow=j.find(xa.dropdown,"._3s1a");xa.items=j.scry(this.getNode(),"._3c_");za=xa.items.length;}j.appendContent(xa.tabs,xa.dropdown);var bb=0;for(ab=za-1;ab>0&&bb<=0;ab--)if(xa.items[ab]!==wa._tabNode){j.prependContent(xa.overflow,xa.items[ab]);bb=ya-xa.tabs.offsetWidth;xa.hidden++;}};va.createFromArray=function(wa){"use strict";return wa.map(function(xa){return new va(xa.controller,xa.sk,xa.label,xa.title);});};va.getIDBySK=function(wa){"use strict";return n.PREFIX_MEDLEY+wa;};va.registerCollections=function(wa,xa,ya){"use strict";x.callWithSection(va.getIDBySK(wa),function(za){za._tabObj=null;if(za.childSections){var ab=za.childSections.getHead();while(ab){ab._resetAuxContent();ab=ab.getNext();}}t.createFromArray(wa,xa).forEach(za.appendSection,za);var bb=za.childSections.get(ya);za.setActiveCollection(bb);bb.setIsLoaded(true);});};va.removeEmptyAppSection=function(wa){"use strict";x.callWithSection(va.getIDBySK(wa),function(xa){xa.remove();});};Object.assign(va,s);e.exports=va;},null);
__d("TimelinePlacesSection",["TimelineAppSection","TimelinePlacesCollection"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();for(var i in g)if(g.hasOwnProperty(i))k[i]=g[i];var j=g===null?null:g.prototype;k.prototype=Object.create(j);k.prototype.constructor=k;k.__superConstructor__=g;function k(l,m,n,o){"use strict";g.call(this,l,m,n,o);}k.prototype.hideCollection=function(l){"use strict";j.hideCollection.call(this,l);if(l instanceof h)l.hide();};k.prototype.showCollection=function(l){"use strict";j.showCollection.call(this,l);if(l instanceof h)l.show();};e.exports=k;},null);
__d("TimelineAppSectionFactory",["TimelineAppSection","TimelinePlacesSection"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();var i="map";function j(){"use strict";}j.createFromArray=function(k){"use strict";return k.map(function(l){if(l.sk===i)return new h(l.controller,l.sk,l.label,l.title);return new g(l.controller,l.sk,l.label,l.title);});};e.exports=j;},null);
__d("TimelineMedley",["Arbiter","CSS","DOM","DOMQuery","ProfileOverviewDOMID","PageTransitions","ProfileTabUtils","TimelineAppSection","TimelineAppSectionFactory","TimelineMonitor","ProfileOverviewSection","TimelineURI","URI","ViewportBounds","$","csx","cx","ge","getElementPosition"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){b.__markCompiled&&b.__markCompiled();var z=2,aa=false;for(var ba in q)if(q.hasOwnProperty(ba))da[ba]=q[ba];var ca=q===null?null:q.prototype;da.prototype=Object.create(ca);da.prototype.constructor=da;da.__superConstructor__=q;function da(ea,fa,ga){"use strict";q.call(this,k.MEDLEY_ROOT);this._sectionBreaker=ga.breaker;o.createFromArray(ea).forEach(this.appendSection,this);p.monitorSection(this);this._lastLoadedSection=this.childSections.get(n.getIDBySK(fa)).setIsLoaded(true);q.setActiveSectionID(this._lastLoadedSection.id);if(aa&&this.isOverviewProfileTab())this.addSectionPlaceholders();var ha=s.getNextURI();this._vanity=r.getVanityFromURI(ha);this._sk=r.getTabKeyFromURI(ha);l.registerHandler(this._transitionHandler.bind(this));}da.prototype.addSectionTeasers=function(){"use strict";if(!this.isOverviewProfileTab()){h.removeClass(this.getNode(),"_c4f");this.thawChildren();this.addSectionPlaceholders();this.addSectionBreak();}};da.prototype.addUpcomingSectionPlaceholders=function(ea,fa){"use strict";fa=fa||z;while(ea=ea.getNext())if(!this.addSectionPlaceholder(ea,ea.getPrev())&&--fa<=0)break;};da.prototype.addSectionPlaceholder=function(ea,fa,ga){"use strict";if(!ea.isLoaded()&&x(ea.nodeID))return false;if(!x(ea.nodeID)){i.insertAfter(fa.getNode(),ea.getNode());ea.createTriggerLoader(ga);return false;}return true;};da.prototype.addSectionBreak=function(){"use strict";if(this._lastLoadedSection.getNext()){i.insertAfter(this.childSections.getHead().getNode(),this._sectionBreaker);}else i.remove(this._sectionBreaker);};da.prototype.removeChildSection=function(ea){"use strict";this.childSections.remove(ea);if(this.childSections.getCount()==1)i.remove(this._sectionBreaker);};da.prototype.addSectionPlaceholders=function(){"use strict";this.addUpcomingSectionPlaceholders(this._lastLoadedSection);};da.prototype.getNode=function(){"use strict";return u(this.id);};da.prototype.isOverviewProfileTab=function(){"use strict";return m.isOverviewTab(this._sk);};da.prototype.toggleScrollLoad=function(ea){"use strict";aa=ea;if(ea){this.thawChildren();this.addSectionPlaceholders();}else this.freezeChildren();};da.prototype._transitionHandler=function(ea){"use strict";if(r.getVanityFromURI(ea)!==this._vanity)return false;var fa=r.getTabKeyFromURI(ea);if(m.isTimelineTab(fa))return false;if(m.isOverviewTab(fa)){return false;}else{var ga=ea.getQueryData();if(!ga.next_cursor)return false;var ha=this.childSections.getHead();while(ha){if(ha._sk===fa){if(!ha._activeCollection||!j.scry(ha._activeCollection.getNode(),"._3t3")[0])return false;g.inform("save_facebar_query",true);setTimeout(this._transitionToSection.bind(this,ha,ga),0);return true;}ha=ha.getNext();}}return false;};da.prototype._transitionToSection=function(ea,fa){"use strict";var ga=y(ea.getNode()).y-t.getTop();i.scry(ea.getNode(),"._51k9").forEach(function(ja){h.removeClass(ja,"_51k9");});this._sk=ea._sk;q.setActiveSectionID(ea.id);ea.thaw();h.addClass(this.getNode(),"_c4f");this.freezeChildren();var ha=j.find(ea._activeCollection.getNode(),"._3t3");ea._activeCollection.addContentLoader(ha,fa.next_cursor);ea._activeCollection._contentLoader.load({node:ha});var ia=this.childSections.getHead();while(ia&&ia.id!==ea.id){ia.remove();ia=this.childSections.getHead();}q.inform('Medley/transitionToSection',ea.id);ea.scrollTo(ga<0?ga:0);l.transitionComplete();};da.loadToSection=function(ea,fa){"use strict";q.setActiveSectionID(ea);q.callWithSection(k.MEDLEY_ROOT,function(ga){var ha=ga.childSections.getHead(),ia=0;while(ha&&ha.id!==ea){ia++;ha=ha.getNext();}if(!ia)return fa(ha);ia--;ia&&ga.addUpcomingSectionPlaceholders(ga.childSections.getHead(),ia);ga.addSectionPlaceholder(ha,ha.getPrev(),true);var ja=ha.subscribe('loaded',function(){fa(ha);ja.unsubscribe();});});};da.scrollToSection=function(ea,fa,ga){"use strict";q.callWithSection(ea,function(ha){ha.scrollTo(fa,ga);});};da.toggleScrollLoad=function(ea){"use strict";aa=ea;q.callWithSection(k.MEDLEY_ROOT,function(fa){fa.toggleScrollLoad(ea);});};e.exports=da;},null);
__d("PhotosAppSection",["TimelineAppSection","TimelineAppSectionCuration","TidyArbiterMixin"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();var j=Object.assign({init:function(k){var l=g.getIDBySK(k);h.subscribe('toggle_drawer',function(m,n){if(n.section.id===l)j.inform('toggle_drawer',n);});}},i);e.exports=j;},null);
__d("PhotoCreateButtonsVisibility",["Arbiter","CSS","csx","cx","DOMQuery","Event","Parent","$"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){b.__markCompiled&&b.__markCompiled();function o(q){var r=m.byClass(q,"_3cz");return k.find(r,"._69l");}var p={addHideClickListener:function(q){l.listen(q,'click',function(){h.hide(o(q));});},addShowClickListener:function(q){l.listen(q,'click',function(){h.show(o(q));});},hideButtons:function(q){var r=n('pagelet_timeline_medley_photos');h.hide(k.find(r,"._69l"));},showButtonOnTabChange:function(q){g.subscribe('Medley/tab-change',function(r){h.show(q);});}};e.exports=p;},null);